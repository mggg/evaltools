<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>gerrytools.geometry API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../gerrytools.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;gerrytools</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="geometry/dissolve.html">dissolve</a></li>
                    <li><a href="geometry/dualgraph.html">dualgraph</a></li>
                    <li><a href="geometry/unitmap.html">unitmap</a></li>
                    <li><a href="geometry/dataframe.html">dataframe</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#minimize_dispersion">minimize_dispersion</a>
            </li>
            <li>
                    <a class="function" href="#minimize_dispersion_with_parity">minimize_dispersion_with_parity</a>
            </li>
            <li>
                    <a class="function" href="#minimize_parity">minimize_parity</a>
            </li>
            <li>
                    <a class="function" href="#calculate_dispersion">calculate_dispersion</a>
            </li>
            <li>
                    <a class="function" href="#dispersion_updater_closure">dispersion_updater_closure</a>
            </li>
            <li>
                    <a class="function" href="#dissolve">dissolve</a>
            </li>
            <li>
                    <a class="function" href="#dualgraph">dualgraph</a>
            </li>
            <li>
                    <a class="function" href="#unitmap">unitmap</a>
            </li>
            <li>
                    <a class="function" href="#invert">invert</a>
            </li>
            <li>
                    <a class="function" href="#dataframe">dataframe</a>
            </li>
            <li>
                    <a class="function" href="#populationoverlap">populationoverlap</a>
            </li>
            <li>
                    <a class="function" href="#optimalrelabeling">optimalrelabeling</a>
            </li>
            <li>
                    <a class="function" href="#arealoverlap">arealoverlap</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../gerrytools.html">gerrytools</a><wbr>.geometry    </h1>

                        <div class="docstring"><p>Provides ease-of-use functionality for geographic and geometric operations.</p>
</div>

                        <input id="mod-geometry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-geometry-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">Provides ease-of-use functionality for geographic and geometric operations.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">.dataframe</span> <span class="kn">import</span> <span class="n">dataframe</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.dissolve</span> <span class="kn">import</span> <span class="n">dissolve</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.dualgraph</span> <span class="kn">import</span> <span class="n">dualgraph</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.optimize</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>    <span class="n">arealoverlap</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>    <span class="n">calculate_dispersion</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="n">minimize_dispersion</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a>    <span class="n">minimize_dispersion_with_parity</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>    <span class="n">minimize_parity</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>    <span class="n">optimalrelabeling</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">populationoverlap</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="p">)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="kn">from</span> <span class="nn">.unitmap</span> <span class="kn">import</span> <span class="n">invert</span><span class="p">,</span> <span class="n">unitmap</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="kn">from</span> <span class="nn">.updater</span> <span class="kn">import</span> <span class="n">dispersion_updater_closure</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;minimize_dispersion&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;minimize_dispersion_with_parity&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;minimize_parity&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;calculate_dispersion&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;dispersion_updater_closure&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;dissolve&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;dualgraph&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;unitmap&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;invert&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;dataframe&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;populationoverlap&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>    <span class="s2">&quot;optimalrelabeling&quot;</span><span class="p">,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a>    <span class="s2">&quot;arealoverlap&quot;</span><span class="p">,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="minimize_dispersion">
                            <input id="minimize_dispersion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">minimize_dispersion</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">units</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">extra_constraints</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="minimize_dispersion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#minimize_dispersion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="minimize_dispersion-257"><a href="#minimize_dispersion-257"><span class="linenos">257</span></a><span class="k">def</span> <span class="nf">minimize_dispersion</span><span class="p">(</span>
</span><span id="minimize_dispersion-258"><a href="#minimize_dispersion-258"><span class="linenos">258</span></a>    <span class="n">units</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="minimize_dispersion-259"><a href="#minimize_dispersion-259"><span class="linenos">259</span></a>    <span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_dispersion-260"><a href="#minimize_dispersion-260"><span class="linenos">260</span></a>    <span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_dispersion-261"><a href="#minimize_dispersion-261"><span class="linenos">261</span></a>    <span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_dispersion-262"><a href="#minimize_dispersion-262"><span class="linenos">262</span></a>    <span class="n">extra_constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="minimize_dispersion-263"><a href="#minimize_dispersion-263"><span class="linenos">263</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="minimize_dispersion-264"><a href="#minimize_dispersion-264"><span class="linenos">264</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="minimize_dispersion-265"><a href="#minimize_dispersion-265"><span class="linenos">265</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="minimize_dispersion-266"><a href="#minimize_dispersion-266"><span class="linenos">266</span></a><span class="sd">    Minimize core dispersion in a state given an column with enacted districts</span>
</span><span id="minimize_dispersion-267"><a href="#minimize_dispersion-267"><span class="linenos">267</span></a><span class="sd">    and a column with proposed numberings. Returns a dictionary relabeling the</span>
</span><span id="minimize_dispersion-268"><a href="#minimize_dispersion-268"><span class="linenos">268</span></a><span class="sd">    proposed cols. Used in WI. Assumes that district labels are 1-indexed.</span>
</span><span id="minimize_dispersion-269"><a href="#minimize_dispersion-269"><span class="linenos">269</span></a>
</span><span id="minimize_dispersion-270"><a href="#minimize_dispersion-270"><span class="linenos">270</span></a><span class="sd">    Args:</span>
</span><span id="minimize_dispersion-271"><a href="#minimize_dispersion-271"><span class="linenos">271</span></a><span class="sd">        units: The units to optimize on. E.g. Census blocks.</span>
</span><span id="minimize_dispersion-272"><a href="#minimize_dispersion-272"><span class="linenos">272</span></a><span class="sd">        enacted_col: The column in the GeoDataFrame with the enacted districts.</span>
</span><span id="minimize_dispersion-273"><a href="#minimize_dispersion-273"><span class="linenos">273</span></a><span class="sd">        proposed_col: The column in the GeoDataFrame with the proposed districts.</span>
</span><span id="minimize_dispersion-274"><a href="#minimize_dispersion-274"><span class="linenos">274</span></a><span class="sd">        extra_constraints: Optional; A function that can add extra constraints</span>
</span><span id="minimize_dispersion-275"><a href="#minimize_dispersion-275"><span class="linenos">275</span></a><span class="sd">            to the model, such as parity (in the case of WI).</span>
</span><span id="minimize_dispersion-276"><a href="#minimize_dispersion-276"><span class="linenos">276</span></a><span class="sd">        verbose: If true, do not suppress solver output. Otherwise, stay quiet.</span>
</span><span id="minimize_dispersion-277"><a href="#minimize_dispersion-277"><span class="linenos">277</span></a>
</span><span id="minimize_dispersion-278"><a href="#minimize_dispersion-278"><span class="linenos">278</span></a><span class="sd">    Returns:</span>
</span><span id="minimize_dispersion-279"><a href="#minimize_dispersion-279"><span class="linenos">279</span></a><span class="sd">        A dictionary mapping proposed labels to optimized labels.</span>
</span><span id="minimize_dispersion-280"><a href="#minimize_dispersion-280"><span class="linenos">280</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="minimize_dispersion-281"><a href="#minimize_dispersion-281"><span class="linenos">281</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ensure_column_types</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="p">[</span><span class="n">enacted_col</span><span class="p">,</span> <span class="n">proposed_col</span><span class="p">]):</span>
</span><span id="minimize_dispersion-282"><a href="#minimize_dispersion-282"><span class="linenos">282</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Your enacted and proposed columns must be an int type!&quot;</span><span class="p">)</span>
</span><span id="minimize_dispersion-283"><a href="#minimize_dispersion-283"><span class="linenos">283</span></a>
</span><span id="minimize_dispersion-284"><a href="#minimize_dispersion-284"><span class="linenos">284</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ensure_column_types</span><span class="p">(</span>
</span><span id="minimize_dispersion-285"><a href="#minimize_dispersion-285"><span class="linenos">285</span></a>        <span class="n">units</span><span class="p">,</span> <span class="p">[</span><span class="n">pop_col</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="minimize_dispersion-286"><a href="#minimize_dispersion-286"><span class="linenos">286</span></a>    <span class="p">):</span>
</span><span id="minimize_dispersion-287"><a href="#minimize_dispersion-287"><span class="linenos">287</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Your pop col must be an int or float type!&quot;</span><span class="p">)</span>
</span><span id="minimize_dispersion-288"><a href="#minimize_dispersion-288"><span class="linenos">288</span></a>
</span><span id="minimize_dispersion-289"><a href="#minimize_dispersion-289"><span class="linenos">289</span></a>    <span class="n">districts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">proposed_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)))</span>
</span><span id="minimize_dispersion-290"><a href="#minimize_dispersion-290"><span class="linenos">290</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;state_model&quot;</span><span class="p">)</span>
</span><span id="minimize_dispersion-291"><a href="#minimize_dispersion-291"><span class="linenos">291</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">verbose</span><span class="p">))</span>
</span><span id="minimize_dispersion-292"><a href="#minimize_dispersion-292"><span class="linenos">292</span></a>
</span><span id="minimize_dispersion-293"><a href="#minimize_dispersion-293"><span class="linenos">293</span></a>    <span class="n">numbering</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="minimize_dispersion-294"><a href="#minimize_dispersion-294"><span class="linenos">294</span></a>        <span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">),</span> <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;numbering&quot;</span>
</span><span id="minimize_dispersion-295"><a href="#minimize_dispersion-295"><span class="linenos">295</span></a>    <span class="p">)</span>
</span><span id="minimize_dispersion-296"><a href="#minimize_dispersion-296"><span class="linenos">296</span></a>
</span><span id="minimize_dispersion-297"><a href="#minimize_dispersion-297"><span class="linenos">297</span></a>    <span class="n">exprs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="minimize_dispersion-298"><a href="#minimize_dispersion-298"><span class="linenos">298</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="minimize_dispersion-299"><a href="#minimize_dispersion-299"><span class="linenos">299</span></a>
</span><span id="minimize_dispersion-300"><a href="#minimize_dispersion-300"><span class="linenos">300</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="minimize_dispersion-301"><a href="#minimize_dispersion-301"><span class="linenos">301</span></a>            <span class="k">return</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="minimize_dispersion-302"><a href="#minimize_dispersion-302"><span class="linenos">302</span></a>
</span><span id="minimize_dispersion-303"><a href="#minimize_dispersion-303"><span class="linenos">303</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="minimize_dispersion-304"><a href="#minimize_dispersion-304"><span class="linenos">304</span></a>
</span><span id="minimize_dispersion-305"><a href="#minimize_dispersion-305"><span class="linenos">305</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="minimize_dispersion-306"><a href="#minimize_dispersion-306"><span class="linenos">306</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="minimize_dispersion-307"><a href="#minimize_dispersion-307"><span class="linenos">307</span></a>
</span><span id="minimize_dispersion-308"><a href="#minimize_dispersion-308"><span class="linenos">308</span></a>    <span class="k">for</span> <span class="n">district</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">districts</span><span class="p">):</span>  <span class="c1"># iter over proposed</span>
</span><span id="minimize_dispersion-309"><a href="#minimize_dispersion-309"><span class="linenos">309</span></a>        <span class="n">enacted_intersection</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="minimize_dispersion-310"><a href="#minimize_dispersion-310"><span class="linenos">310</span></a>            <span class="n">units</span><span class="p">[</span><span class="n">units</span><span class="p">[</span><span class="n">proposed_col</span><span class="p">]</span> <span class="o">==</span> <span class="n">district</span><span class="p">]</span>
</span><span id="minimize_dispersion-311"><a href="#minimize_dispersion-311"><span class="linenos">311</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">enacted_col</span><span class="p">)</span>
</span><span id="minimize_dispersion-312"><a href="#minimize_dispersion-312"><span class="linenos">312</span></a>            <span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="n">pop_col</span><span class="p">]</span>
</span><span id="minimize_dispersion-313"><a href="#minimize_dispersion-313"><span class="linenos">313</span></a>            <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="minimize_dispersion-314"><a href="#minimize_dispersion-314"><span class="linenos">314</span></a>        <span class="p">)</span>
</span><span id="minimize_dispersion-315"><a href="#minimize_dispersion-315"><span class="linenos">315</span></a>
</span><span id="minimize_dispersion-316"><a href="#minimize_dispersion-316"><span class="linenos">316</span></a>        <span class="k">for</span> <span class="p">(</span>
</span><span id="minimize_dispersion-317"><a href="#minimize_dispersion-317"><span class="linenos">317</span></a>            <span class="n">enacted</span><span class="p">,</span>
</span><span id="minimize_dispersion-318"><a href="#minimize_dispersion-318"><span class="linenos">318</span></a>            <span class="n">overlap_pop</span><span class="p">,</span>
</span><span id="minimize_dispersion-319"><a href="#minimize_dispersion-319"><span class="linenos">319</span></a>        <span class="p">)</span> <span class="ow">in</span> <span class="n">enacted_intersection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># maximize overlap; minimize dispersion</span>
</span><span id="minimize_dispersion-320"><a href="#minimize_dispersion-320"><span class="linenos">320</span></a>            <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numbering</span><span class="p">[</span><span class="n">district</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">enacted</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">overlap_pop</span><span class="p">)</span>
</span><span id="minimize_dispersion-321"><a href="#minimize_dispersion-321"><span class="linenos">321</span></a>
</span><span id="minimize_dispersion-322"><a href="#minimize_dispersion-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">extra_constraints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="minimize_dispersion-323"><a href="#minimize_dispersion-323"><span class="linenos">323</span></a>            <span class="n">extra_constraints</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">numbering</span><span class="p">,</span> <span class="n">district</span><span class="p">,</span> <span class="n">districts</span><span class="p">)</span>
</span><span id="minimize_dispersion-324"><a href="#minimize_dispersion-324"><span class="linenos">324</span></a>
</span><span id="minimize_dispersion-325"><a href="#minimize_dispersion-325"><span class="linenos">325</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">addConstrs</span><span class="p">(</span>
</span><span id="minimize_dispersion-326"><a href="#minimize_dispersion-326"><span class="linenos">326</span></a>        <span class="p">(</span><span class="n">numbering</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">))),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span>
</span><span id="minimize_dispersion-327"><a href="#minimize_dispersion-327"><span class="linenos">327</span></a>    <span class="p">)</span>
</span><span id="minimize_dispersion-328"><a href="#minimize_dispersion-328"><span class="linenos">328</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">addConstrs</span><span class="p">(</span>
</span><span id="minimize_dispersion-329"><a href="#minimize_dispersion-329"><span class="linenos">329</span></a>        <span class="p">(</span><span class="n">numbering</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">))),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;h&quot;</span>
</span><span id="minimize_dispersion-330"><a href="#minimize_dispersion-330"><span class="linenos">330</span></a>    <span class="p">)</span>
</span><span id="minimize_dispersion-331"><a href="#minimize_dispersion-331"><span class="linenos">331</span></a>
</span><span id="minimize_dispersion-332"><a href="#minimize_dispersion-332"><span class="linenos">332</span></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">exprs</span><span class="p">)</span>
</span><span id="minimize_dispersion-333"><a href="#minimize_dispersion-333"><span class="linenos">333</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MAXIMIZE</span><span class="p">)</span>
</span><span id="minimize_dispersion-334"><a href="#minimize_dispersion-334"><span class="linenos">334</span></a>
</span><span id="minimize_dispersion-335"><a href="#minimize_dispersion-335"><span class="linenos">335</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="minimize_dispersion-336"><a href="#minimize_dispersion-336"><span class="linenos">336</span></a>
</span><span id="minimize_dispersion-337"><a href="#minimize_dispersion-337"><span class="linenos">337</span></a>    <span class="n">solution</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">getVars</span><span class="p">()</span>
</span><span id="minimize_dispersion-338"><a href="#minimize_dispersion-338"><span class="linenos">338</span></a>
</span><span id="minimize_dispersion-339"><a href="#minimize_dispersion-339"><span class="linenos">339</span></a>    <span class="n">numbering_mapping</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="minimize_dispersion-340"><a href="#minimize_dispersion-340"><span class="linenos">340</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">)):</span>
</span><span id="minimize_dispersion-341"><a href="#minimize_dispersion-341"><span class="linenos">341</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">)):</span>
</span><span id="minimize_dispersion-342"><a href="#minimize_dispersion-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="n">solution</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">)</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">:</span>
</span><span id="minimize_dispersion-343"><a href="#minimize_dispersion-343"><span class="linenos">343</span></a>                <span class="n">numbering_mapping</span><span class="p">[</span><span class="n">districts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">districts</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="minimize_dispersion-344"><a href="#minimize_dispersion-344"><span class="linenos">344</span></a>
</span><span id="minimize_dispersion-345"><a href="#minimize_dispersion-345"><span class="linenos">345</span></a>    <span class="k">return</span> <span class="n">numbering_mapping</span>
</span></pre></div>


            <div class="docstring"><p>Minimize core dispersion in a state given an column with enacted districts
and a column with proposed numberings. Returns a dictionary relabeling the
proposed cols. Used in WI. Assumes that district labels are 1-indexed.</p>

<p>Args:
    units: The units to optimize on. E.g. Census blocks.
    enacted_col: The column in the GeoDataFrame with the enacted districts.
    proposed_col: The column in the GeoDataFrame with the proposed districts.
    extra_constraints: Optional; A function that can add extra constraints
        to the model, such as parity (in the case of WI).
    verbose: If true, do not suppress solver output. Otherwise, stay quiet.</p>

<p>Returns:
    A dictionary mapping proposed labels to optimized labels.</p>
</div>


                </section>
                <section id="minimize_dispersion_with_parity">
                            <input id="minimize_dispersion_with_parity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">minimize_dispersion_with_parity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">units</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">extra_constraints</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="minimize_dispersion_with_parity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#minimize_dispersion_with_parity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="minimize_dispersion_with_parity-416"><a href="#minimize_dispersion_with_parity-416"><span class="linenos">416</span></a><span class="k">def</span> <span class="nf">minimize_dispersion_with_parity</span><span class="p">(</span>
</span><span id="minimize_dispersion_with_parity-417"><a href="#minimize_dispersion_with_parity-417"><span class="linenos">417</span></a>    <span class="n">units</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="minimize_dispersion_with_parity-418"><a href="#minimize_dispersion_with_parity-418"><span class="linenos">418</span></a>    <span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_dispersion_with_parity-419"><a href="#minimize_dispersion_with_parity-419"><span class="linenos">419</span></a>    <span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_dispersion_with_parity-420"><a href="#minimize_dispersion_with_parity-420"><span class="linenos">420</span></a>    <span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_dispersion_with_parity-421"><a href="#minimize_dispersion_with_parity-421"><span class="linenos">421</span></a>    <span class="n">extra_constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="minimize_dispersion_with_parity-422"><a href="#minimize_dispersion_with_parity-422"><span class="linenos">422</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="minimize_dispersion_with_parity-423"><a href="#minimize_dispersion_with_parity-423"><span class="linenos">423</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="minimize_dispersion_with_parity-424"><a href="#minimize_dispersion_with_parity-424"><span class="linenos">424</span></a><span class="sd">    Minimize dispersion and odd-&gt;even parity shift in a state given an column with</span>
</span><span id="minimize_dispersion_with_parity-425"><a href="#minimize_dispersion_with_parity-425"><span class="linenos">425</span></a><span class="sd">    enacted districts and a column with proposed numberings. Returns a dictionary</span>
</span><span id="minimize_dispersion_with_parity-426"><a href="#minimize_dispersion_with_parity-426"><span class="linenos">426</span></a><span class="sd">    relabeling the proposed cols. Used in WI. Assumes that district labels are 1-indexed.</span>
</span><span id="minimize_dispersion_with_parity-427"><a href="#minimize_dispersion_with_parity-427"><span class="linenos">427</span></a>
</span><span id="minimize_dispersion_with_parity-428"><a href="#minimize_dispersion_with_parity-428"><span class="linenos">428</span></a><span class="sd">    Args:</span>
</span><span id="minimize_dispersion_with_parity-429"><a href="#minimize_dispersion_with_parity-429"><span class="linenos">429</span></a><span class="sd">        units: The units to optimize on. E.g. Census blocks.</span>
</span><span id="minimize_dispersion_with_parity-430"><a href="#minimize_dispersion_with_parity-430"><span class="linenos">430</span></a><span class="sd">        enacted_col: The column in the GeoDataFrame with the enacted districts.</span>
</span><span id="minimize_dispersion_with_parity-431"><a href="#minimize_dispersion_with_parity-431"><span class="linenos">431</span></a><span class="sd">        proposed_col: The column in the GeoDataFrame with the proposed districts.</span>
</span><span id="minimize_dispersion_with_parity-432"><a href="#minimize_dispersion_with_parity-432"><span class="linenos">432</span></a><span class="sd">        pop_col: The column in the GeoDataFrame with population counts.</span>
</span><span id="minimize_dispersion_with_parity-433"><a href="#minimize_dispersion_with_parity-433"><span class="linenos">433</span></a><span class="sd">        extra_constraints: Optional; A function that can add extra constraints</span>
</span><span id="minimize_dispersion_with_parity-434"><a href="#minimize_dispersion_with_parity-434"><span class="linenos">434</span></a><span class="sd">            to the model, such as parity (in the case of WI).</span>
</span><span id="minimize_dispersion_with_parity-435"><a href="#minimize_dispersion_with_parity-435"><span class="linenos">435</span></a>
</span><span id="minimize_dispersion_with_parity-436"><a href="#minimize_dispersion_with_parity-436"><span class="linenos">436</span></a><span class="sd">    Returns:</span>
</span><span id="minimize_dispersion_with_parity-437"><a href="#minimize_dispersion_with_parity-437"><span class="linenos">437</span></a><span class="sd">        A dictionary mapping proposed labels to optimized labels.</span>
</span><span id="minimize_dispersion_with_parity-438"><a href="#minimize_dispersion_with_parity-438"><span class="linenos">438</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="minimize_dispersion_with_parity-439"><a href="#minimize_dispersion_with_parity-439"><span class="linenos">439</span></a>    <span class="n">optimal_parity_mapping</span> <span class="o">=</span> <span class="n">minimize_parity</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">enacted_col</span><span class="p">,</span> <span class="n">proposed_col</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">)</span>
</span><span id="minimize_dispersion_with_parity-440"><a href="#minimize_dispersion_with_parity-440"><span class="linenos">440</span></a>
</span><span id="minimize_dispersion_with_parity-441"><a href="#minimize_dispersion_with_parity-441"><span class="linenos">441</span></a>    <span class="k">def</span> <span class="nf">parity_constraint</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">numbering</span><span class="p">,</span> <span class="n">district</span><span class="p">,</span> <span class="n">districts</span><span class="p">):</span>
</span><span id="minimize_dispersion_with_parity-442"><a href="#minimize_dispersion_with_parity-442"><span class="linenos">442</span></a>        <span class="k">if</span> <span class="n">optimal_parity_mapping</span><span class="p">[</span><span class="n">district</span><span class="p">]:</span>
</span><span id="minimize_dispersion_with_parity-443"><a href="#minimize_dispersion_with_parity-443"><span class="linenos">443</span></a>            <span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span>
</span><span id="minimize_dispersion_with_parity-444"><a href="#minimize_dispersion_with_parity-444"><span class="linenos">444</span></a>                <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span>
</span><span id="minimize_dispersion_with_parity-445"><a href="#minimize_dispersion_with_parity-445"><span class="linenos">445</span></a>                    <span class="n">numbering</span><span class="p">[</span><span class="n">district</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="minimize_dispersion_with_parity-446"><a href="#minimize_dispersion_with_parity-446"><span class="linenos">446</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="minimize_dispersion_with_parity-447"><a href="#minimize_dispersion_with_parity-447"><span class="linenos">447</span></a>                    <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="minimize_dispersion_with_parity-448"><a href="#minimize_dispersion_with_parity-448"><span class="linenos">448</span></a>                <span class="p">)</span>
</span><span id="minimize_dispersion_with_parity-449"><a href="#minimize_dispersion_with_parity-449"><span class="linenos">449</span></a>                <span class="o">==</span> <span class="mi">1</span>
</span><span id="minimize_dispersion_with_parity-450"><a href="#minimize_dispersion_with_parity-450"><span class="linenos">450</span></a>            <span class="p">)</span>
</span><span id="minimize_dispersion_with_parity-451"><a href="#minimize_dispersion_with_parity-451"><span class="linenos">451</span></a>
</span><span id="minimize_dispersion_with_parity-452"><a href="#minimize_dispersion_with_parity-452"><span class="linenos">452</span></a>        <span class="n">extra_constraints</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">numbering</span><span class="p">,</span> <span class="n">district</span><span class="p">,</span> <span class="n">districts</span><span class="p">)</span>
</span><span id="minimize_dispersion_with_parity-453"><a href="#minimize_dispersion_with_parity-453"><span class="linenos">453</span></a>
</span><span id="minimize_dispersion_with_parity-454"><a href="#minimize_dispersion_with_parity-454"><span class="linenos">454</span></a>    <span class="k">return</span> <span class="n">minimize_dispersion</span><span class="p">(</span>
</span><span id="minimize_dispersion_with_parity-455"><a href="#minimize_dispersion_with_parity-455"><span class="linenos">455</span></a>        <span class="n">units</span><span class="p">,</span> <span class="n">enacted_col</span><span class="p">,</span> <span class="n">proposed_col</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">,</span> <span class="n">parity_constraint</span>
</span><span id="minimize_dispersion_with_parity-456"><a href="#minimize_dispersion_with_parity-456"><span class="linenos">456</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Minimize dispersion and odd->even parity shift in a state given an column with
enacted districts and a column with proposed numberings. Returns a dictionary
relabeling the proposed cols. Used in WI. Assumes that district labels are 1-indexed.</p>

<p>Args:
    units: The units to optimize on. E.g. Census blocks.
    enacted_col: The column in the GeoDataFrame with the enacted districts.
    proposed_col: The column in the GeoDataFrame with the proposed districts.
    pop_col: The column in the GeoDataFrame with population counts.
    extra_constraints: Optional; A function that can add extra constraints
        to the model, such as parity (in the case of WI).</p>

<p>Returns:
    A dictionary mapping proposed labels to optimized labels.</p>
</div>


                </section>
                <section id="minimize_parity">
                            <input id="minimize_parity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">minimize_parity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">units</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="minimize_parity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#minimize_parity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="minimize_parity-348"><a href="#minimize_parity-348"><span class="linenos">348</span></a><span class="k">def</span> <span class="nf">minimize_parity</span><span class="p">(</span>
</span><span id="minimize_parity-349"><a href="#minimize_parity-349"><span class="linenos">349</span></a>    <span class="n">units</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="minimize_parity-350"><a href="#minimize_parity-350"><span class="linenos">350</span></a>    <span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_parity-351"><a href="#minimize_parity-351"><span class="linenos">351</span></a>    <span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_parity-352"><a href="#minimize_parity-352"><span class="linenos">352</span></a>    <span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="minimize_parity-353"><a href="#minimize_parity-353"><span class="linenos">353</span></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="minimize_parity-354"><a href="#minimize_parity-354"><span class="linenos">354</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="minimize_parity-355"><a href="#minimize_parity-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="minimize_parity-356"><a href="#minimize_parity-356"><span class="linenos">356</span></a><span class="sd">    Minimize odd-&gt;even parity shift in a state given an column with enacted districts</span>
</span><span id="minimize_parity-357"><a href="#minimize_parity-357"><span class="linenos">357</span></a><span class="sd">    and a column with proposed numberings. Returns a dictionary with the parity of the</span>
</span><span id="minimize_parity-358"><a href="#minimize_parity-358"><span class="linenos">358</span></a><span class="sd">    proposed cols. Used in WI. Assumes that district labels are 1-indexed.</span>
</span><span id="minimize_parity-359"><a href="#minimize_parity-359"><span class="linenos">359</span></a>
</span><span id="minimize_parity-360"><a href="#minimize_parity-360"><span class="linenos">360</span></a><span class="sd">    Args:</span>
</span><span id="minimize_parity-361"><a href="#minimize_parity-361"><span class="linenos">361</span></a><span class="sd">        units: The units to optimize on. E.g. Census blocks.</span>
</span><span id="minimize_parity-362"><a href="#minimize_parity-362"><span class="linenos">362</span></a><span class="sd">        enacted_col: The column in the GeoDataFrame with the enacted districts.</span>
</span><span id="minimize_parity-363"><a href="#minimize_parity-363"><span class="linenos">363</span></a><span class="sd">        proposed_col: The column in the GeoDataFrame with the proposed districts.</span>
</span><span id="minimize_parity-364"><a href="#minimize_parity-364"><span class="linenos">364</span></a><span class="sd">        pop_col: The column in the GeoDataFrame with population counts.</span>
</span><span id="minimize_parity-365"><a href="#minimize_parity-365"><span class="linenos">365</span></a><span class="sd">        verbose: If true, do not suppress solver output. Otherwise, stay quiet.</span>
</span><span id="minimize_parity-366"><a href="#minimize_parity-366"><span class="linenos">366</span></a>
</span><span id="minimize_parity-367"><a href="#minimize_parity-367"><span class="linenos">367</span></a><span class="sd">    Returns:</span>
</span><span id="minimize_parity-368"><a href="#minimize_parity-368"><span class="linenos">368</span></a><span class="sd">        A dictionary mapping proposed labels to booleans values representing the optimal parity.</span>
</span><span id="minimize_parity-369"><a href="#minimize_parity-369"><span class="linenos">369</span></a><span class="sd">        (True if even, False odd).</span>
</span><span id="minimize_parity-370"><a href="#minimize_parity-370"><span class="linenos">370</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="minimize_parity-371"><a href="#minimize_parity-371"><span class="linenos">371</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ensure_column_types</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="p">[</span><span class="n">enacted_col</span><span class="p">,</span> <span class="n">proposed_col</span><span class="p">]):</span>
</span><span id="minimize_parity-372"><a href="#minimize_parity-372"><span class="linenos">372</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Your enacted and proposed columns must be an int type!&quot;</span><span class="p">)</span>
</span><span id="minimize_parity-373"><a href="#minimize_parity-373"><span class="linenos">373</span></a>
</span><span id="minimize_parity-374"><a href="#minimize_parity-374"><span class="linenos">374</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ensure_column_types</span><span class="p">(</span>
</span><span id="minimize_parity-375"><a href="#minimize_parity-375"><span class="linenos">375</span></a>        <span class="n">units</span><span class="p">,</span> <span class="p">[</span><span class="n">pop_col</span><span class="p">],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="minimize_parity-376"><a href="#minimize_parity-376"><span class="linenos">376</span></a>    <span class="p">):</span>
</span><span id="minimize_parity-377"><a href="#minimize_parity-377"><span class="linenos">377</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Your pop col must be an int or float type!&quot;</span><span class="p">)</span>
</span><span id="minimize_parity-378"><a href="#minimize_parity-378"><span class="linenos">378</span></a>
</span><span id="minimize_parity-379"><a href="#minimize_parity-379"><span class="linenos">379</span></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;parity_model&quot;</span><span class="p">)</span>
</span><span id="minimize_parity-380"><a href="#minimize_parity-380"><span class="linenos">380</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">verbose</span><span class="p">))</span>
</span><span id="minimize_parity-381"><a href="#minimize_parity-381"><span class="linenos">381</span></a>
</span><span id="minimize_parity-382"><a href="#minimize_parity-382"><span class="linenos">382</span></a>    <span class="n">districts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">units</span><span class="p">[</span><span class="n">proposed_col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)))</span>
</span><span id="minimize_parity-383"><a href="#minimize_parity-383"><span class="linenos">383</span></a>    <span class="n">districts_even</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="minimize_parity-384"><a href="#minimize_parity-384"><span class="linenos">384</span></a>        <span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">),</span> <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">BINARY</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;districts_even&quot;</span>
</span><span id="minimize_parity-385"><a href="#minimize_parity-385"><span class="linenos">385</span></a>    <span class="p">)</span>
</span><span id="minimize_parity-386"><a href="#minimize_parity-386"><span class="linenos">386</span></a>
</span><span id="minimize_parity-387"><a href="#minimize_parity-387"><span class="linenos">387</span></a>    <span class="n">exprs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="minimize_parity-388"><a href="#minimize_parity-388"><span class="linenos">388</span></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="minimize_parity-389"><a href="#minimize_parity-389"><span class="linenos">389</span></a>
</span><span id="minimize_parity-390"><a href="#minimize_parity-390"><span class="linenos">390</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="minimize_parity-391"><a href="#minimize_parity-391"><span class="linenos">391</span></a>            <span class="k">return</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="minimize_parity-392"><a href="#minimize_parity-392"><span class="linenos">392</span></a>
</span><span id="minimize_parity-393"><a href="#minimize_parity-393"><span class="linenos">393</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="minimize_parity-394"><a href="#minimize_parity-394"><span class="linenos">394</span></a>
</span><span id="minimize_parity-395"><a href="#minimize_parity-395"><span class="linenos">395</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="minimize_parity-396"><a href="#minimize_parity-396"><span class="linenos">396</span></a>            <span class="k">return</span> <span class="n">x</span>
</span><span id="minimize_parity-397"><a href="#minimize_parity-397"><span class="linenos">397</span></a>
</span><span id="minimize_parity-398"><a href="#minimize_parity-398"><span class="linenos">398</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">units</span><span class="p">[[</span><span class="n">enacted_col</span><span class="p">,</span> <span class="n">proposed_col</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">]]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
</span><span id="minimize_parity-399"><a href="#minimize_parity-399"><span class="linenos">399</span></a>        <span class="n">district</span> <span class="o">=</span> <span class="n">districts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="n">proposed_col</span><span class="p">]))</span>
</span><span id="minimize_parity-400"><a href="#minimize_parity-400"><span class="linenos">400</span></a>        <span class="n">isOdd</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">block</span><span class="p">[</span><span class="n">enacted_col</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="minimize_parity-401"><a href="#minimize_parity-401"><span class="linenos">401</span></a>        <span class="n">exprs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isOdd</span> <span class="o">*</span> <span class="n">districts_even</span><span class="p">[</span><span class="n">district</span><span class="p">]</span> <span class="o">*</span> <span class="n">block</span><span class="p">[</span><span class="n">pop_col</span><span class="p">])</span>
</span><span id="minimize_parity-402"><a href="#minimize_parity-402"><span class="linenos">402</span></a>
</span><span id="minimize_parity-403"><a href="#minimize_parity-403"><span class="linenos">403</span></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">exprs</span><span class="p">)</span>
</span><span id="minimize_parity-404"><a href="#minimize_parity-404"><span class="linenos">404</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="n">districts_even</span><span class="p">)</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">districts</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;c0&quot;</span><span class="p">)</span>
</span><span id="minimize_parity-405"><a href="#minimize_parity-405"><span class="linenos">405</span></a>
</span><span id="minimize_parity-406"><a href="#minimize_parity-406"><span class="linenos">406</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span><span class="p">)</span>
</span><span id="minimize_parity-407"><a href="#minimize_parity-407"><span class="linenos">407</span></a>    <span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="minimize_parity-408"><a href="#minimize_parity-408"><span class="linenos">408</span></a>
</span><span id="minimize_parity-409"><a href="#minimize_parity-409"><span class="linenos">409</span></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="minimize_parity-410"><a href="#minimize_parity-410"><span class="linenos">410</span></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">getVars</span><span class="p">()):</span>
</span><span id="minimize_parity-411"><a href="#minimize_parity-411"><span class="linenos">411</span></a>        <span class="n">mapping</span><span class="p">[</span><span class="n">districts</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</span><span id="minimize_parity-412"><a href="#minimize_parity-412"><span class="linenos">412</span></a>
</span><span id="minimize_parity-413"><a href="#minimize_parity-413"><span class="linenos">413</span></a>    <span class="k">return</span> <span class="n">mapping</span>
</span></pre></div>


            <div class="docstring"><p>Minimize odd->even parity shift in a state given an column with enacted districts
and a column with proposed numberings. Returns a dictionary with the parity of the
proposed cols. Used in WI. Assumes that district labels are 1-indexed.</p>

<p>Args:
    units: The units to optimize on. E.g. Census blocks.
    enacted_col: The column in the GeoDataFrame with the enacted districts.
    proposed_col: The column in the GeoDataFrame with the proposed districts.
    pop_col: The column in the GeoDataFrame with population counts.
    verbose: If true, do not suppress solver output. Otherwise, stay quiet.</p>

<p>Returns:
    A dictionary mapping proposed labels to booleans values representing the optimal parity.
    (True if even, False odd).</p>
</div>


                </section>
                <section id="calculate_dispersion">
                            <input id="calculate_dispersion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">calculate_dispersion</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">units</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="calculate_dispersion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#calculate_dispersion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="calculate_dispersion-459"><a href="#calculate_dispersion-459"><span class="linenos">459</span></a><span class="k">def</span> <span class="nf">calculate_dispersion</span><span class="p">(</span>
</span><span id="calculate_dispersion-460"><a href="#calculate_dispersion-460"><span class="linenos">460</span></a>    <span class="n">units</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">proposed_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="calculate_dispersion-461"><a href="#calculate_dispersion-461"><span class="linenos">461</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="calculate_dispersion-462"><a href="#calculate_dispersion-462"><span class="linenos">462</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="calculate_dispersion-463"><a href="#calculate_dispersion-463"><span class="linenos">463</span></a><span class="sd">    Calculates core dispersion in a state given an column with enacted districts</span>
</span><span id="calculate_dispersion-464"><a href="#calculate_dispersion-464"><span class="linenos">464</span></a><span class="sd">    and a column with proposed numberings. Used in WI.</span>
</span><span id="calculate_dispersion-465"><a href="#calculate_dispersion-465"><span class="linenos">465</span></a>
</span><span id="calculate_dispersion-466"><a href="#calculate_dispersion-466"><span class="linenos">466</span></a><span class="sd">    Args:</span>
</span><span id="calculate_dispersion-467"><a href="#calculate_dispersion-467"><span class="linenos">467</span></a><span class="sd">        units: The units to optimize on. E.g. Census blocks.</span>
</span><span id="calculate_dispersion-468"><a href="#calculate_dispersion-468"><span class="linenos">468</span></a><span class="sd">        enacted_col: The column in the GeoDataFrame with the enacted districts.</span>
</span><span id="calculate_dispersion-469"><a href="#calculate_dispersion-469"><span class="linenos">469</span></a><span class="sd">        proposed_col: The column in the GeoDataFrame with the proposed districts.</span>
</span><span id="calculate_dispersion-470"><a href="#calculate_dispersion-470"><span class="linenos">470</span></a><span class="sd">        pop_col: The column in the GeoDataFrame with population counts.</span>
</span><span id="calculate_dispersion-471"><a href="#calculate_dispersion-471"><span class="linenos">471</span></a>
</span><span id="calculate_dispersion-472"><a href="#calculate_dispersion-472"><span class="linenos">472</span></a><span class="sd">    Returns:</span>
</span><span id="calculate_dispersion-473"><a href="#calculate_dispersion-473"><span class="linenos">473</span></a><span class="sd">        An integer of the absolute number of people who changed districts.</span>
</span><span id="calculate_dispersion-474"><a href="#calculate_dispersion-474"><span class="linenos">474</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="calculate_dispersion-475"><a href="#calculate_dispersion-475"><span class="linenos">475</span></a>    <span class="k">if</span> <span class="n">units</span><span class="p">[</span><span class="n">enacted_col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">units</span><span class="p">[</span><span class="n">proposed_col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">:</span>
</span><span id="calculate_dispersion-476"><a href="#calculate_dispersion-476"><span class="linenos">476</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Your enacted and proposed columns must have the same type!&quot;</span><span class="p">)</span>
</span><span id="calculate_dispersion-477"><a href="#calculate_dispersion-477"><span class="linenos">477</span></a>
</span><span id="calculate_dispersion-478"><a href="#calculate_dispersion-478"><span class="linenos">478</span></a>    <span class="k">return</span> <span class="n">units</span><span class="p">[</span><span class="n">units</span><span class="p">[</span><span class="n">enacted_col</span><span class="p">]</span> <span class="o">!=</span> <span class="n">units</span><span class="p">[</span><span class="n">proposed_col</span><span class="p">]][</span><span class="n">pop_col</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Calculates core dispersion in a state given an column with enacted districts
and a column with proposed numberings. Used in WI.</p>

<p>Args:
    units: The units to optimize on. E.g. Census blocks.
    enacted_col: The column in the GeoDataFrame with the enacted districts.
    proposed_col: The column in the GeoDataFrame with the proposed districts.
    pop_col: The column in the GeoDataFrame with population counts.</p>

<p>Returns:
    An integer of the absolute number of people who changed districts.</p>
</div>


                </section>
                <section id="dispersion_updater_closure">
                            <input id="dispersion_updater_closure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dispersion_updater_closure</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">units</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="dispersion_updater_closure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dispersion_updater_closure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dispersion_updater_closure-8"><a href="#dispersion_updater_closure-8"><span class="linenos"> 8</span></a><span class="k">def</span> <span class="nf">dispersion_updater_closure</span><span class="p">(</span>
</span><span id="dispersion_updater_closure-9"><a href="#dispersion_updater_closure-9"><span class="linenos"> 9</span></a>    <span class="n">units</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span> <span class="n">enacted_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="dispersion_updater_closure-10"><a href="#dispersion_updater_closure-10"><span class="linenos">10</span></a><span class="p">):</span>
</span><span id="dispersion_updater_closure-11"><a href="#dispersion_updater_closure-11"><span class="linenos">11</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="dispersion_updater_closure-12"><a href="#dispersion_updater_closure-12"><span class="linenos">12</span></a><span class="sd">    An updater to calculate best possible dispersion for a `gerrychain.Partition` object.</span>
</span><span id="dispersion_updater_closure-13"><a href="#dispersion_updater_closure-13"><span class="linenos">13</span></a>
</span><span id="dispersion_updater_closure-14"><a href="#dispersion_updater_closure-14"><span class="linenos">14</span></a><span class="sd">    Args:</span>
</span><span id="dispersion_updater_closure-15"><a href="#dispersion_updater_closure-15"><span class="linenos">15</span></a><span class="sd">        units: The units to optimize on. E.g. Census blocks.</span>
</span><span id="dispersion_updater_closure-16"><a href="#dispersion_updater_closure-16"><span class="linenos">16</span></a><span class="sd">        enacted_col: The column in the GeoDataFrame with the enacted districts.</span>
</span><span id="dispersion_updater_closure-17"><a href="#dispersion_updater_closure-17"><span class="linenos">17</span></a><span class="sd">        proposed_col: The column in the GeoDataFrame with the proposed districts.</span>
</span><span id="dispersion_updater_closure-18"><a href="#dispersion_updater_closure-18"><span class="linenos">18</span></a><span class="sd">        extra_constraints: Optional; A function that can add extra constraints</span>
</span><span id="dispersion_updater_closure-19"><a href="#dispersion_updater_closure-19"><span class="linenos">19</span></a><span class="sd">            to the model, such as parity (in the case of WI).</span>
</span><span id="dispersion_updater_closure-20"><a href="#dispersion_updater_closure-20"><span class="linenos">20</span></a><span class="sd">        verbose: If true, do not suppress solver output. Otherwise, stay quiet.</span>
</span><span id="dispersion_updater_closure-21"><a href="#dispersion_updater_closure-21"><span class="linenos">21</span></a>
</span><span id="dispersion_updater_closure-22"><a href="#dispersion_updater_closure-22"><span class="linenos">22</span></a><span class="sd">    Returns:</span>
</span><span id="dispersion_updater_closure-23"><a href="#dispersion_updater_closure-23"><span class="linenos">23</span></a><span class="sd">        An updater that calculates the minimal core dispersion of a Partition object.</span>
</span><span id="dispersion_updater_closure-24"><a href="#dispersion_updater_closure-24"><span class="linenos">24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dispersion_updater_closure-25"><a href="#dispersion_updater_closure-25"><span class="linenos">25</span></a>
</span><span id="dispersion_updater_closure-26"><a href="#dispersion_updater_closure-26"><span class="linenos">26</span></a>    <span class="k">def</span> <span class="nf">updater</span><span class="p">(</span><span class="n">partition</span><span class="p">:</span> <span class="n">gerrychain</span><span class="o">.</span><span class="n">Partition</span><span class="p">):</span>
</span><span id="dispersion_updater_closure-27"><a href="#dispersion_updater_closure-27"><span class="linenos">27</span></a>        <span class="n">units</span><span class="p">[</span><span class="s2">&quot;partition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">partition</span><span class="o">.</span><span class="n">assignment</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>
</span><span id="dispersion_updater_closure-28"><a href="#dispersion_updater_closure-28"><span class="linenos">28</span></a>
</span><span id="dispersion_updater_closure-29"><a href="#dispersion_updater_closure-29"><span class="linenos">29</span></a>        <span class="n">relabeling</span> <span class="o">=</span> <span class="n">minimize_dispersion</span><span class="p">(</span>
</span><span id="dispersion_updater_closure-30"><a href="#dispersion_updater_closure-30"><span class="linenos">30</span></a>            <span class="n">units</span><span class="p">,</span> <span class="n">enacted_col</span><span class="p">,</span> <span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="dispersion_updater_closure-31"><a href="#dispersion_updater_closure-31"><span class="linenos">31</span></a>        <span class="p">)</span>
</span><span id="dispersion_updater_closure-32"><a href="#dispersion_updater_closure-32"><span class="linenos">32</span></a>        <span class="n">units</span><span class="p">[</span><span class="s2">&quot;partition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="s2">&quot;partition&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">relabeling</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span><span id="dispersion_updater_closure-33"><a href="#dispersion_updater_closure-33"><span class="linenos">33</span></a>
</span><span id="dispersion_updater_closure-34"><a href="#dispersion_updater_closure-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="n">calculate_dispersion</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="n">enacted_col</span><span class="p">,</span> <span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="n">pop_col</span><span class="p">)</span>
</span><span id="dispersion_updater_closure-35"><a href="#dispersion_updater_closure-35"><span class="linenos">35</span></a>
</span><span id="dispersion_updater_closure-36"><a href="#dispersion_updater_closure-36"><span class="linenos">36</span></a>    <span class="k">return</span> <span class="n">updater</span>
</span></pre></div>


            <div class="docstring"><p>An updater to calculate best possible dispersion for a <code>gerrychain.Partition</code> object.</p>

<p>Args:
    units: The units to optimize on. E.g. Census blocks.
    enacted_col: The column in the GeoDataFrame with the enacted districts.
    proposed_col: The column in the GeoDataFrame with the proposed districts.
    extra_constraints: Optional; A function that can add extra constraints
        to the model, such as parity (in the case of WI).
    verbose: If true, do not suppress solver output. Otherwise, stay quiet.</p>

<p>Returns:
    An updater that calculates the minimal core dispersion of a Partition object.</p>
</div>


                </section>
                <section id="dissolve">
                            <input id="dissolve-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dissolve</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">geometries</span>,</span><span class="param">	<span class="n">by</span><span class="o">=</span><span class="s1">&#39;DISTRICTN&#39;</span>,</span><span class="param">	<span class="n">reset_index</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">keep</span><span class="o">=</span><span class="p">[]</span>,</span><span class="param">	<span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span></span><span class="return-annotation">) -> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>:</span></span>

                <label class="view-source-button" for="dissolve-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dissolve"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dissolve-18"><a href="#dissolve-18"><span class="linenos">18</span></a><span class="k">def</span> <span class="nf">dissolve</span><span class="p">(</span>
</span><span id="dissolve-19"><a href="#dissolve-19"><span class="linenos">19</span></a>    <span class="n">geometries</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s2">&quot;DISTRICTN&quot;</span><span class="p">,</span> <span class="n">reset_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="p">[],</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span>
</span><span id="dissolve-20"><a href="#dissolve-20"><span class="linenos">20</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GeoDataFrame</span><span class="p">:</span>
</span><span id="dissolve-21"><a href="#dissolve-21"><span class="linenos">21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="dissolve-22"><a href="#dissolve-22"><span class="linenos">22</span></a><span class="sd">    Dissolves `geometries` on the column `by`. Intended to dissolve a set of</span>
</span><span id="dissolve-23"><a href="#dissolve-23"><span class="linenos">23</span></a><span class="sd">    source geometries (e.g. VTDs, blocks, block groups, etc.) to district</span>
</span><span id="dissolve-24"><a href="#dissolve-24"><span class="linenos">24</span></a><span class="sd">    geometries.</span>
</span><span id="dissolve-25"><a href="#dissolve-25"><span class="linenos">25</span></a>
</span><span id="dissolve-26"><a href="#dissolve-26"><span class="linenos">26</span></a><span class="sd">    Args:</span>
</span><span id="dissolve-27"><a href="#dissolve-27"><span class="linenos">27</span></a><span class="sd">        geometries (GeoDataFrame): Set of geometries to be dissolved.</span>
</span><span id="dissolve-28"><a href="#dissolve-28"><span class="linenos">28</span></a><span class="sd">        by (str): Name of the column used to group objects.</span>
</span><span id="dissolve-29"><a href="#dissolve-29"><span class="linenos">29</span></a><span class="sd">        reset_index (boolean, optional): If true, the index of the resulting</span>
</span><span id="dissolve-30"><a href="#dissolve-30"><span class="linenos">30</span></a><span class="sd">            GeoDataFrame will be set to an integer index, not `by`. Defaults to</span>
</span><span id="dissolve-31"><a href="#dissolve-31"><span class="linenos">31</span></a><span class="sd">            `True`.</span>
</span><span id="dissolve-32"><a href="#dissolve-32"><span class="linenos">32</span></a><span class="sd">        keep (list, optional): Additional columns to keep beyond the geometry</span>
</span><span id="dissolve-33"><a href="#dissolve-33"><span class="linenos">33</span></a><span class="sd">            and `by` columns. Defaults to an empty list, so no additional columns</span>
</span><span id="dissolve-34"><a href="#dissolve-34"><span class="linenos">34</span></a><span class="sd">            are kept.</span>
</span><span id="dissolve-35"><a href="#dissolve-35"><span class="linenos">35</span></a><span class="sd">        aggfunc (str, optional): Pandas groupby function type when aggregating;</span>
</span><span id="dissolve-36"><a href="#dissolve-36"><span class="linenos">36</span></a><span class="sd">            defaults to `&quot;sum&quot;`.</span>
</span><span id="dissolve-37"><a href="#dissolve-37"><span class="linenos">37</span></a>
</span><span id="dissolve-38"><a href="#dissolve-38"><span class="linenos">38</span></a><span class="sd">    Returns:</span>
</span><span id="dissolve-39"><a href="#dissolve-39"><span class="linenos">39</span></a><span class="sd">        A `GeoDataFrame` containing dissolved geometries and kept columns</span>
</span><span id="dissolve-40"><a href="#dissolve-40"><span class="linenos">40</span></a><span class="sd">        computed by the function designated by `aggfunc`.</span>
</span><span id="dissolve-41"><a href="#dissolve-41"><span class="linenos">41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dissolve-42"><a href="#dissolve-42"><span class="linenos">42</span></a>    <span class="c1"># Pare down the geometries and dissolve.</span>
</span><span id="dissolve-43"><a href="#dissolve-43"><span class="linenos">43</span></a>    <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="p">[</span><span class="n">keep</span> <span class="o">+</span> <span class="p">[</span><span class="n">by</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
</span><span id="dissolve-44"><a href="#dissolve-44"><span class="linenos">44</span></a>    <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">by</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">aggfunc</span><span class="p">)</span>
</span><span id="dissolve-45"><a href="#dissolve-45"><span class="linenos">45</span></a>    <span class="k">if</span> <span class="n">reset_index</span><span class="p">:</span>
</span><span id="dissolve-46"><a href="#dissolve-46"><span class="linenos">46</span></a>        <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="dissolve-47"><a href="#dissolve-47"><span class="linenos">47</span></a>
</span><span id="dissolve-48"><a href="#dissolve-48"><span class="linenos">48</span></a>    <span class="k">return</span> <span class="n">geometries</span>
</span></pre></div>


            <div class="docstring"><p>Dissolves <code>geometries</code> on the column <code>by</code>. Intended to dissolve a set of
source geometries (e.g. VTDs, blocks, block groups, etc.) to district
geometries.</p>

<p>Args:
    geometries (GeoDataFrame): Set of geometries to be dissolved.
    by (str): Name of the column used to group objects.
    reset_index (boolean, optional): If true, the index of the resulting
        GeoDataFrame will be set to an integer index, not <code>by</code>. Defaults to
        <code>True</code>.
    keep (list, optional): Additional columns to keep beyond the geometry
        and <code>by</code> columns. Defaults to an empty list, so no additional columns
        are kept.
    aggfunc (str, optional): Pandas groupby function type when aggregating;
        defaults to <code>"sum"</code>.</p>

<p>Returns:
    A <code>GeoDataFrame</code> containing dissolved geometries and kept columns
    computed by the function designated by <code>aggfunc</code>.</p>
</div>


                </section>
                <section id="dualgraph">
                            <input id="dualgraph-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dualgraph</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">geometries</span>,</span><span class="param">	<span class="n">index</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">geometrycolumn</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span>,</span><span class="param">	<span class="n">colmap</span><span class="o">=</span><span class="p">{}</span>,</span><span class="param">	<span class="n">buffer</span><span class="o">=</span><span class="mi">0</span>,</span><span class="param">	<span class="n">edges_to_add</span><span class="o">=</span><span class="p">[]</span>,</span><span class="param">	<span class="n">edges_to_cut</span><span class="o">=</span><span class="p">[]</span></span><span class="return-annotation">) -> <span class="n">gerrychain</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span>:</span></span>

                <label class="view-source-button" for="dualgraph-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dualgraph"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dualgraph-5"><a href="#dualgraph-5"><span class="linenos"> 5</span></a><span class="k">def</span> <span class="nf">dualgraph</span><span class="p">(</span>
</span><span id="dualgraph-6"><a href="#dualgraph-6"><span class="linenos"> 6</span></a>    <span class="n">geometries</span><span class="p">,</span>
</span><span id="dualgraph-7"><a href="#dualgraph-7"><span class="linenos"> 7</span></a>    <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="dualgraph-8"><a href="#dualgraph-8"><span class="linenos"> 8</span></a>    <span class="n">geometrycolumn</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
</span><span id="dualgraph-9"><a href="#dualgraph-9"><span class="linenos"> 9</span></a>    <span class="n">colmap</span><span class="o">=</span><span class="p">{},</span>
</span><span id="dualgraph-10"><a href="#dualgraph-10"><span class="linenos">10</span></a>    <span class="n">buffer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="dualgraph-11"><a href="#dualgraph-11"><span class="linenos">11</span></a>    <span class="n">edges_to_add</span><span class="o">=</span><span class="p">[],</span>
</span><span id="dualgraph-12"><a href="#dualgraph-12"><span class="linenos">12</span></a>    <span class="n">edges_to_cut</span><span class="o">=</span><span class="p">[],</span>
</span><span id="dualgraph-13"><a href="#dualgraph-13"><span class="linenos">13</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Graph</span><span class="p">:</span>
</span><span id="dualgraph-14"><a href="#dualgraph-14"><span class="linenos">14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="dualgraph-15"><a href="#dualgraph-15"><span class="linenos">15</span></a><span class="sd">    Generates a graph dual to the provided geometric data.</span>
</span><span id="dualgraph-16"><a href="#dualgraph-16"><span class="linenos">16</span></a>
</span><span id="dualgraph-17"><a href="#dualgraph-17"><span class="linenos">17</span></a><span class="sd">    Args:</span>
</span><span id="dualgraph-18"><a href="#dualgraph-18"><span class="linenos">18</span></a><span class="sd">        geometries (GeoDataFrame): Geometric data represented as a GeoDataFrame.</span>
</span><span id="dualgraph-19"><a href="#dualgraph-19"><span class="linenos">19</span></a><span class="sd">        index (str, optional): Unique identifiers; indexing column of `geometries`.</span>
</span><span id="dualgraph-20"><a href="#dualgraph-20"><span class="linenos">20</span></a><span class="sd">            If this value is not set, vertex labels are integer indices; otherwise,</span>
</span><span id="dualgraph-21"><a href="#dualgraph-21"><span class="linenos">21</span></a><span class="sd">            vertex labels are the values of this column. Defaults to `&quot;geometry&quot;`.</span>
</span><span id="dualgraph-22"><a href="#dualgraph-22"><span class="linenos">22</span></a><span class="sd">        colmap (dict, optional): Maps old column names to new column names.</span>
</span><span id="dualgraph-23"><a href="#dualgraph-23"><span class="linenos">23</span></a><span class="sd">        buffer (float, optional): Geometric buffer distance; defaults to `0`.</span>
</span><span id="dualgraph-24"><a href="#dualgraph-24"><span class="linenos">24</span></a><span class="sd">        edges_to_add (list, optional): Edges to add to the graph object. Assumed to</span>
</span><span id="dualgraph-25"><a href="#dualgraph-25"><span class="linenos">25</span></a><span class="sd">            be a list of pairs of objects, e.g. `[(u, v), ...]` where `u` and `v`</span>
</span><span id="dualgraph-26"><a href="#dualgraph-26"><span class="linenos">26</span></a><span class="sd">            are vertex labels consistent with `index`.</span>
</span><span id="dualgraph-27"><a href="#dualgraph-27"><span class="linenos">27</span></a><span class="sd">        edges_to_cut (list, optional): Edges to cut from the graph object. Assumed</span>
</span><span id="dualgraph-28"><a href="#dualgraph-28"><span class="linenos">28</span></a><span class="sd">            to be a list of pairs of objects, e.g. `[(u, v), ...]` where `u` and</span>
</span><span id="dualgraph-29"><a href="#dualgraph-29"><span class="linenos">29</span></a><span class="sd">            `v` are vertex labels consistent with `index`.</span>
</span><span id="dualgraph-30"><a href="#dualgraph-30"><span class="linenos">30</span></a>
</span><span id="dualgraph-31"><a href="#dualgraph-31"><span class="linenos">31</span></a><span class="sd">    Returns:</span>
</span><span id="dualgraph-32"><a href="#dualgraph-32"><span class="linenos">32</span></a><span class="sd">        A gerrychain `Graph` object dual to the geometric data.</span>
</span><span id="dualgraph-33"><a href="#dualgraph-33"><span class="linenos">33</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dualgraph-34"><a href="#dualgraph-34"><span class="linenos">34</span></a>    <span class="c1"># Buffer geometries by default.</span>
</span><span id="dualgraph-35"><a href="#dualgraph-35"><span class="linenos">35</span></a>    <span class="n">geometries</span><span class="p">[</span><span class="n">geometrycolumn</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometries</span><span class="p">[</span><span class="n">geometrycolumn</span><span class="p">]</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
</span><span id="dualgraph-36"><a href="#dualgraph-36"><span class="linenos">36</span></a>
</span><span id="dualgraph-37"><a href="#dualgraph-37"><span class="linenos">37</span></a>    <span class="c1"># Set indices and rename columns.</span>
</span><span id="dualgraph-38"><a href="#dualgraph-38"><span class="linenos">38</span></a>    <span class="k">if</span> <span class="n">index</span><span class="p">:</span>
</span><span id="dualgraph-39"><a href="#dualgraph-39"><span class="linenos">39</span></a>        <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="dualgraph-40"><a href="#dualgraph-40"><span class="linenos">40</span></a>    <span class="k">if</span> <span class="n">colmap</span><span class="p">:</span>
</span><span id="dualgraph-41"><a href="#dualgraph-41"><span class="linenos">41</span></a>        <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">colmap</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="dualgraph-42"><a href="#dualgraph-42"><span class="linenos">42</span></a>
</span><span id="dualgraph-43"><a href="#dualgraph-43"><span class="linenos">43</span></a>    <span class="c1"># Generate the dual graph.</span>
</span><span id="dualgraph-44"><a href="#dualgraph-44"><span class="linenos">44</span></a>    <span class="n">dg</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">from_geodataframe</span><span class="p">(</span><span class="n">geometries</span><span class="p">,</span> <span class="n">adjacency</span><span class="o">=</span><span class="s2">&quot;rook&quot;</span><span class="p">)</span>
</span><span id="dualgraph-45"><a href="#dualgraph-45"><span class="linenos">45</span></a>
</span><span id="dualgraph-46"><a href="#dualgraph-46"><span class="linenos">46</span></a>    <span class="c1"># Add and remove extraneous edges.</span>
</span><span id="dualgraph-47"><a href="#dualgraph-47"><span class="linenos">47</span></a>    <span class="k">for</span> <span class="n">add</span> <span class="ow">in</span> <span class="n">edges_to_add</span><span class="p">:</span>
</span><span id="dualgraph-48"><a href="#dualgraph-48"><span class="linenos">48</span></a>        <span class="n">dg</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">*</span><span class="n">add</span><span class="p">)</span>
</span><span id="dualgraph-49"><a href="#dualgraph-49"><span class="linenos">49</span></a>    <span class="k">for</span> <span class="n">cut</span> <span class="ow">in</span> <span class="n">edges_to_cut</span><span class="p">:</span>
</span><span id="dualgraph-50"><a href="#dualgraph-50"><span class="linenos">50</span></a>        <span class="n">dg</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="n">cut</span><span class="p">)</span>
</span><span id="dualgraph-51"><a href="#dualgraph-51"><span class="linenos">51</span></a>
</span><span id="dualgraph-52"><a href="#dualgraph-52"><span class="linenos">52</span></a>    <span class="c1"># Return the graph!</span>
</span><span id="dualgraph-53"><a href="#dualgraph-53"><span class="linenos">53</span></a>    <span class="k">return</span> <span class="n">dg</span>
</span></pre></div>


            <div class="docstring"><p>Generates a graph dual to the provided geometric data.</p>

<p>Args:
    geometries (GeoDataFrame): Geometric data represented as a GeoDataFrame.
    index (str, optional): Unique identifiers; indexing column of <code>geometries</code>.
        If this value is not set, vertex labels are integer indices; otherwise,
        vertex labels are the values of this column. Defaults to <code>"geometry"</code>.
    colmap (dict, optional): Maps old column names to new column names.
    buffer (float, optional): Geometric buffer distance; defaults to <code>0</code>.
    edges_to_add (list, optional): Edges to add to the graph object. Assumed to
        be a list of pairs of objects, e.g. <code>[(u, v), ...]</code> where <code>u</code> and <code>v</code>
        are vertex labels consistent with <code>index</code>.
    edges_to_cut (list, optional): Edges to cut from the graph object. Assumed
        to be a list of pairs of objects, e.g. <code>[(u, v), ...]</code> where <code>u</code> and
        <code>v</code> are vertex labels consistent with <code>index</code>.</p>

<p>Returns:
    A gerrychain <code>Graph</code> object dual to the geometric data.</p>
</div>


                </section>
                <section id="unitmap">
                            <input id="unitmap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unitmap</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">source</span>, </span><span class="param"><span class="n">target</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="unitmap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#unitmap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="unitmap-11"><a href="#unitmap-11"><span class="linenos">11</span></a><span class="k">def</span> <span class="nf">unitmap</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="unitmap-12"><a href="#unitmap-12"><span class="linenos">12</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="unitmap-13"><a href="#unitmap-13"><span class="linenos">13</span></a><span class="sd">    Creates a mapping from source units to target units.</span>
</span><span id="unitmap-14"><a href="#unitmap-14"><span class="linenos">14</span></a>
</span><span id="unitmap-15"><a href="#unitmap-15"><span class="linenos">15</span></a><span class="sd">    Args:</span>
</span><span id="unitmap-16"><a href="#unitmap-16"><span class="linenos">16</span></a><span class="sd">        source (tuple): 2-tuple containing a `GeoDataFrame` and an index name corresponding</span>
</span><span id="unitmap-17"><a href="#unitmap-17"><span class="linenos">17</span></a><span class="sd">            to the unique identifiers of the units, e.g. `(vtds, &quot;GEOID20&quot;)`.</span>
</span><span id="unitmap-18"><a href="#unitmap-18"><span class="linenos">18</span></a><span class="sd">            Unique identifiers will be keys in the resulting dictionary.</span>
</span><span id="unitmap-19"><a href="#unitmap-19"><span class="linenos">19</span></a><span class="sd">        target (tuple): 2-tuple containing a `GeoDataFrame` and an index name corresponding</span>
</span><span id="unitmap-20"><a href="#unitmap-20"><span class="linenos">20</span></a><span class="sd">            to the unique identifiers of the units, e.g. `(districts, &quot;DISTRICTN&quot;)`.</span>
</span><span id="unitmap-21"><a href="#unitmap-21"><span class="linenos">21</span></a><span class="sd">            Unique identifiers will be values in the resulting dictionary.</span>
</span><span id="unitmap-22"><a href="#unitmap-22"><span class="linenos">22</span></a>
</span><span id="unitmap-23"><a href="#unitmap-23"><span class="linenos">23</span></a><span class="sd">    Returns:</span>
</span><span id="unitmap-24"><a href="#unitmap-24"><span class="linenos">24</span></a><span class="sd">        A dictionary mapping `_from` unique identifiers to `_to` unique identifiers.</span>
</span><span id="unitmap-25"><a href="#unitmap-25"><span class="linenos">25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="unitmap-26"><a href="#unitmap-26"><span class="linenos">26</span></a>    <span class="c1"># Explode each of the tuples.</span>
</span><span id="unitmap-27"><a href="#unitmap-27"><span class="linenos">27</span></a>    <span class="n">source_shapes</span><span class="p">,</span> <span class="n">source_index</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="unitmap-28"><a href="#unitmap-28"><span class="linenos">28</span></a>    <span class="n">target_shapes</span><span class="p">,</span> <span class="n">target_index</span> <span class="o">=</span> <span class="n">target</span>
</span><span id="unitmap-29"><a href="#unitmap-29"><span class="linenos">29</span></a>
</span><span id="unitmap-30"><a href="#unitmap-30"><span class="linenos">30</span></a>    <span class="c1"># Get rid of all the unnecessary data and set the indices of each dataframe</span>
</span><span id="unitmap-31"><a href="#unitmap-31"><span class="linenos">31</span></a>    <span class="c1"># to the specified indices.</span>
</span><span id="unitmap-32"><a href="#unitmap-32"><span class="linenos">32</span></a>    <span class="n">source_shapes</span> <span class="o">=</span> <span class="n">source_shapes</span><span class="p">[[</span><span class="n">source_index</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">source_index</span><span class="p">)</span>
</span><span id="unitmap-33"><a href="#unitmap-33"><span class="linenos">33</span></a>    <span class="n">target_shapes</span> <span class="o">=</span> <span class="n">target_shapes</span><span class="p">[[</span><span class="n">target_index</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">target_index</span><span class="p">)</span>
</span><span id="unitmap-34"><a href="#unitmap-34"><span class="linenos">34</span></a>
</span><span id="unitmap-35"><a href="#unitmap-35"><span class="linenos">35</span></a>    <span class="c1"># Ensure we&#39;re in the same CRS.</span>
</span><span id="unitmap-36"><a href="#unitmap-36"><span class="linenos">36</span></a>    <span class="n">target_shapes</span> <span class="o">=</span> <span class="n">target_shapes</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">source_shapes</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="unitmap-37"><a href="#unitmap-37"><span class="linenos">37</span></a>
</span><span id="unitmap-38"><a href="#unitmap-38"><span class="linenos">38</span></a>    <span class="c1"># Set a progress bar; filter out all warnings; create the mapping.</span>
</span><span id="unitmap-39"><a href="#unitmap-39"><span class="linenos">39</span></a>    <span class="n">maup</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="unitmap-40"><a href="#unitmap-40"><span class="linenos">40</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
</span><span id="unitmap-41"><a href="#unitmap-41"><span class="linenos">41</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>
</span><span id="unitmap-42"><a href="#unitmap-42"><span class="linenos">42</span></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="n">maup</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">source_shapes</span><span class="p">,</span> <span class="n">target_shapes</span><span class="p">)</span>
</span><span id="unitmap-43"><a href="#unitmap-43"><span class="linenos">43</span></a>
</span><span id="unitmap-44"><a href="#unitmap-44"><span class="linenos">44</span></a>    <span class="c1"># Reset the mapping&#39;s index, zip, and return.</span>
</span><span id="unitmap-45"><a href="#unitmap-45"><span class="linenos">45</span></a>    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span><span id="unitmap-46"><a href="#unitmap-46"><span class="linenos">46</span></a>    <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
</span><span id="unitmap-47"><a href="#unitmap-47"><span class="linenos">47</span></a>    <span class="n">mapping</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">]</span>
</span><span id="unitmap-48"><a href="#unitmap-48"><span class="linenos">48</span></a>
</span><span id="unitmap-49"><a href="#unitmap-49"><span class="linenos">49</span></a>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">mapping</span><span class="p">[</span><span class="n">r</span><span class="p">]))</span>
</span></pre></div>


            <div class="docstring"><p>Creates a mapping from source units to target units.</p>

<p>Args:
    source (tuple): 2-tuple containing a <code>GeoDataFrame</code> and an index name corresponding
        to the unique identifiers of the units, e.g. <code>(vtds, "GEOID20")</code>.
        Unique identifiers will be keys in the resulting dictionary.
    target (tuple): 2-tuple containing a <code>GeoDataFrame</code> and an index name corresponding
        to the unique identifiers of the units, e.g. <code>(districts, "DISTRICTN")</code>.
        Unique identifiers will be values in the resulting dictionary.</p>

<p>Returns:
    A dictionary mapping <code>_from</code> unique identifiers to <code>_to</code> unique identifiers.</p>
</div>


                </section>
                <section id="invert">
                            <input id="invert-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">invert</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">unitmap</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="o">~</span><span class="n">A</span><span class="p">,</span> <span class="o">~</span><span class="n">B</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="o">~</span><span class="n">B</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="o">~</span><span class="n">A</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="invert-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#invert"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="invert-52"><a href="#invert-52"><span class="linenos">52</span></a><span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="n">unitmap</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">A</span><span class="p">]]:</span>
</span><span id="invert-53"><a href="#invert-53"><span class="linenos">53</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="invert-54"><a href="#invert-54"><span class="linenos">54</span></a><span class="sd">    Inverts the provided unit mapping.</span>
</span><span id="invert-55"><a href="#invert-55"><span class="linenos">55</span></a>
</span><span id="invert-56"><a href="#invert-56"><span class="linenos">56</span></a><span class="sd">    Args:</span>
</span><span id="invert-57"><a href="#invert-57"><span class="linenos">57</span></a><span class="sd">        unitmap: Dictionary taking source unique identifiers to target unique</span>
</span><span id="invert-58"><a href="#invert-58"><span class="linenos">58</span></a><span class="sd">            identifiers.</span>
</span><span id="invert-59"><a href="#invert-59"><span class="linenos">59</span></a>
</span><span id="invert-60"><a href="#invert-60"><span class="linenos">60</span></a><span class="sd">    Returns:</span>
</span><span id="invert-61"><a href="#invert-61"><span class="linenos">61</span></a><span class="sd">        A dictionary mapping target unique identifiers to _lists_ of source</span>
</span><span id="invert-62"><a href="#invert-62"><span class="linenos">62</span></a><span class="sd">        unique identifiers.</span>
</span><span id="invert-63"><a href="#invert-63"><span class="linenos">63</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="invert-64"><a href="#invert-64"><span class="linenos">64</span></a>    <span class="c1"># Invert the dictionary.</span>
</span><span id="invert-65"><a href="#invert-65"><span class="linenos">65</span></a>    <span class="n">inverse</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">B</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">A</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="invert-66"><a href="#invert-66"><span class="linenos">66</span></a>
</span><span id="invert-67"><a href="#invert-67"><span class="linenos">67</span></a>    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">unitmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="invert-68"><a href="#invert-68"><span class="linenos">68</span></a>        <span class="k">if</span> <span class="n">inverse</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="invert-69"><a href="#invert-69"><span class="linenos">69</span></a>            <span class="n">inverse</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="invert-70"><a href="#invert-70"><span class="linenos">70</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="invert-71"><a href="#invert-71"><span class="linenos">71</span></a>            <span class="n">inverse</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
</span><span id="invert-72"><a href="#invert-72"><span class="linenos">72</span></a>
</span><span id="invert-73"><a href="#invert-73"><span class="linenos">73</span></a>    <span class="k">return</span> <span class="n">inverse</span>
</span></pre></div>


            <div class="docstring"><p>Inverts the provided unit mapping.</p>

<p>Args:
    unitmap: Dictionary taking source unique identifiers to target unique
        identifiers.</p>

<p>Returns:
    A dictionary mapping target unique identifiers to _lists_ of source
    unique identifiers.</p>
</div>


                </section>
                <section id="dataframe">
                            <input id="dataframe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dataframe</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">P</span><span class="p">:</span> <span class="n">gerrychain</span><span class="o">.</span><span class="n">partition</span><span class="o">.</span><span class="n">partition</span><span class="o">.</span><span class="n">Partition</span>,</span><span class="param">	<span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span>,</span><span class="param">	<span class="n">assignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;DISTRICT&#39;</span>,</span><span class="param">	<span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="dataframe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dataframe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dataframe-6"><a href="#dataframe-6"><span class="linenos"> 6</span></a><span class="k">def</span> <span class="nf">dataframe</span><span class="p">(</span>
</span><span id="dataframe-7"><a href="#dataframe-7"><span class="linenos"> 7</span></a>    <span class="n">P</span><span class="p">:</span> <span class="n">Partition</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">assignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DISTRICT&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="dataframe-8"><a href="#dataframe-8"><span class="linenos"> 8</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="dataframe-9"><a href="#dataframe-9"><span class="linenos"> 9</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="dataframe-10"><a href="#dataframe-10"><span class="linenos">10</span></a><span class="sd">    Converts a `Partition` into a `DataFrame`.</span>
</span><span id="dataframe-11"><a href="#dataframe-11"><span class="linenos">11</span></a>
</span><span id="dataframe-12"><a href="#dataframe-12"><span class="linenos">12</span></a><span class="sd">    Args:</span>
</span><span id="dataframe-13"><a href="#dataframe-13"><span class="linenos">13</span></a><span class="sd">        P (Partition): GerryChain `Partition` object to have its data framed.</span>
</span><span id="dataframe-14"><a href="#dataframe-14"><span class="linenos">14</span></a><span class="sd">        index (str, optional): Graph attribute to use as an index. The `networkx`</span>
</span><span id="dataframe-15"><a href="#dataframe-15"><span class="linenos">15</span></a><span class="sd">            default name is `&quot;id&quot;`.</span>
</span><span id="dataframe-16"><a href="#dataframe-16"><span class="linenos">16</span></a><span class="sd">        assignment (str, optional): Column name for assignment.</span>
</span><span id="dataframe-17"><a href="#dataframe-17"><span class="linenos">17</span></a><span class="sd">        columns (list, optional): List of columns to add to the dataframe, not</span>
</span><span id="dataframe-18"><a href="#dataframe-18"><span class="linenos">18</span></a><span class="sd">            including the index. If `None` (or another falsy value), gets all</span>
</span><span id="dataframe-19"><a href="#dataframe-19"><span class="linenos">19</span></a><span class="sd">            columns.</span>
</span><span id="dataframe-20"><a href="#dataframe-20"><span class="linenos">20</span></a>
</span><span id="dataframe-21"><a href="#dataframe-21"><span class="linenos">21</span></a><span class="sd">    Returns:</span>
</span><span id="dataframe-22"><a href="#dataframe-22"><span class="linenos">22</span></a><span class="sd">        `DataFrame` with attached graph data.</span>
</span><span id="dataframe-23"><a href="#dataframe-23"><span class="linenos">23</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dataframe-24"><a href="#dataframe-24"><span class="linenos">24</span></a>    <span class="c1"># Create dataframe.</span>
</span><span id="dataframe-25"><a href="#dataframe-25"><span class="linenos">25</span></a>    <span class="n">gdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span>
</span><span id="dataframe-26"><a href="#dataframe-26"><span class="linenos">26</span></a>        <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">}</span> <span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">P</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="dataframe-27"><a href="#dataframe-27"><span class="linenos">27</span></a>    <span class="p">)</span>
</span><span id="dataframe-28"><a href="#dataframe-28"><span class="linenos">28</span></a>
</span><span id="dataframe-29"><a href="#dataframe-29"><span class="linenos">29</span></a>    <span class="c1"># Assign vertices.</span>
</span><span id="dataframe-30"><a href="#dataframe-30"><span class="linenos">30</span></a>    <span class="n">assignedvertices</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">assignment</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="dataframe-31"><a href="#dataframe-31"><span class="linenos">31</span></a>    <span class="n">gdf</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">assignedvertices</span><span class="p">)</span>
</span><span id="dataframe-32"><a href="#dataframe-32"><span class="linenos">32</span></a>
</span><span id="dataframe-33"><a href="#dataframe-33"><span class="linenos">33</span></a>    <span class="c1"># Drop columns if necessary.</span>
</span><span id="dataframe-34"><a href="#dataframe-34"><span class="linenos">34</span></a>    <span class="k">if</span> <span class="n">columns</span><span class="p">:</span>
</span><span id="dataframe-35"><a href="#dataframe-35"><span class="linenos">35</span></a>        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[[</span><span class="n">assignment</span><span class="p">,</span> <span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">columns</span><span class="p">]</span>
</span><span id="dataframe-36"><a href="#dataframe-36"><span class="linenos">36</span></a>
</span><span id="dataframe-37"><a href="#dataframe-37"><span class="linenos">37</span></a>    <span class="k">return</span> <span class="n">gdf</span>
</span></pre></div>


            <div class="docstring"><p>Converts a <code>Partition</code> into a <code>DataFrame</code>.</p>

<p>Args:
    P (Partition): GerryChain <code>Partition</code> object to have its data framed.
    index (str, optional): Graph attribute to use as an index. The <code>networkx</code>
        default name is <code>"id"</code>.
    assignment (str, optional): Column name for assignment.
    columns (list, optional): List of columns to add to the dataframe, not
        including the index. If <code>None</code> (or another falsy value), gets all
        columns.</p>

<p>Returns:
    <code>DataFrame</code> with attached graph data.</p>
</div>


                </section>
                <section id="populationoverlap">
                            <input id="populationoverlap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">populationoverlap</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">left</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">right</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;GEOID20&#39;</span>,</span><span class="param">	<span class="n">population</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;TOTPOP20&#39;</span>,</span><span class="param">	<span class="n">assignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;DISTRICT&#39;</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="populationoverlap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#populationoverlap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="populationoverlap-73"><a href="#populationoverlap-73"><span class="linenos"> 73</span></a><span class="k">def</span> <span class="nf">populationoverlap</span><span class="p">(</span>
</span><span id="populationoverlap-74"><a href="#populationoverlap-74"><span class="linenos"> 74</span></a>    <span class="n">left</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="populationoverlap-75"><a href="#populationoverlap-75"><span class="linenos"> 75</span></a>    <span class="n">right</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="populationoverlap-76"><a href="#populationoverlap-76"><span class="linenos"> 76</span></a>    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GEOID20&quot;</span><span class="p">,</span>
</span><span id="populationoverlap-77"><a href="#populationoverlap-77"><span class="linenos"> 77</span></a>    <span class="n">population</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TOTPOP20&quot;</span><span class="p">,</span>
</span><span id="populationoverlap-78"><a href="#populationoverlap-78"><span class="linenos"> 78</span></a>    <span class="n">assignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DISTRICT&quot;</span><span class="p">,</span>
</span><span id="populationoverlap-79"><a href="#populationoverlap-79"><span class="linenos"> 79</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="populationoverlap-80"><a href="#populationoverlap-80"><span class="linenos"> 80</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="populationoverlap-81"><a href="#populationoverlap-81"><span class="linenos"> 81</span></a><span class="sd">    Given two unit-level DataFrames — i.e. two dataframes where each row represents</span>
</span><span id="populationoverlap-82"><a href="#populationoverlap-82"><span class="linenos"> 82</span></a><span class="sd">    an atomic unit like Census blocks or VTDs, and each row contains a district</span>
</span><span id="populationoverlap-83"><a href="#populationoverlap-83"><span class="linenos"> 83</span></a><span class="sd">    assignment — computes the amount of population shared by each pair of districts.</span>
</span><span id="populationoverlap-84"><a href="#populationoverlap-84"><span class="linenos"> 84</span></a><span class="sd">    `left` is the districting plan to be relabeled (e.g. a proposed districting</span>
</span><span id="populationoverlap-85"><a href="#populationoverlap-85"><span class="linenos"> 85</span></a><span class="sd">    plan) and `right` is the districting plan with district labels we&#39;re trying</span>
</span><span id="populationoverlap-86"><a href="#populationoverlap-86"><span class="linenos"> 86</span></a><span class="sd">    to match (e.g. an enacted districting plan). If `left` (denoted \(L\)) has</span>
</span><span id="populationoverlap-87"><a href="#populationoverlap-87"><span class="linenos"> 87</span></a><span class="sd">    \(n\) districts and `right` (denoted \(R\)) has \(m\) districts, an</span>
</span><span id="populationoverlap-88"><a href="#populationoverlap-88"><span class="linenos"> 88</span></a><span class="sd">    \(n \times m\) matrix \(C\) is computed, where the entry \(M_{ij}\) represents</span>
</span><span id="populationoverlap-89"><a href="#populationoverlap-89"><span class="linenos"> 89</span></a><span class="sd">    the population shared by the districts \(L_i\) and \(R_j\). \(C\) is</span>
</span><span id="populationoverlap-90"><a href="#populationoverlap-90"><span class="linenos"> 90</span></a><span class="sd">    represented as a pandas DataFrame, where the row indices are the labels in</span>
</span><span id="populationoverlap-91"><a href="#populationoverlap-91"><span class="linenos"> 91</span></a><span class="sd">    `left`, and are the preimage of the label mapping; column indices are the labels</span>
</span><span id="populationoverlap-92"><a href="#populationoverlap-92"><span class="linenos"> 92</span></a><span class="sd">    in `right`, and are the image of the label mapping.</span>
</span><span id="populationoverlap-93"><a href="#populationoverlap-93"><span class="linenos"> 93</span></a>
</span><span id="populationoverlap-94"><a href="#populationoverlap-94"><span class="linenos"> 94</span></a><span class="sd">    Args:</span>
</span><span id="populationoverlap-95"><a href="#populationoverlap-95"><span class="linenos"> 95</span></a><span class="sd">        left (pd.DataFrame): DataFrame whose labels are the preimage of the relabeling.</span>
</span><span id="populationoverlap-96"><a href="#populationoverlap-96"><span class="linenos"> 96</span></a><span class="sd">        right (pd.DataFrame): DataFrame whose labels are the image of the relabeling.</span>
</span><span id="populationoverlap-97"><a href="#populationoverlap-97"><span class="linenos"> 97</span></a><span class="sd">        identifier (str): Column on `left` and `right` which contains the unique</span>
</span><span id="populationoverlap-98"><a href="#populationoverlap-98"><span class="linenos"> 98</span></a><span class="sd">            identifier for each unit.</span>
</span><span id="populationoverlap-99"><a href="#populationoverlap-99"><span class="linenos"> 99</span></a><span class="sd">        population (str): Column on `left` and `right` which contains the population</span>
</span><span id="populationoverlap-100"><a href="#populationoverlap-100"><span class="linenos">100</span></a><span class="sd">            total for each unit. This can be modified to be `any` population.</span>
</span><span id="populationoverlap-101"><a href="#populationoverlap-101"><span class="linenos">101</span></a><span class="sd">        assignment (str): Column on `left` and `right` that denotes district membership.</span>
</span><span id="populationoverlap-102"><a href="#populationoverlap-102"><span class="linenos">102</span></a>
</span><span id="populationoverlap-103"><a href="#populationoverlap-103"><span class="linenos">103</span></a><span class="sd">    Returns:</span>
</span><span id="populationoverlap-104"><a href="#populationoverlap-104"><span class="linenos">104</span></a><span class="sd">        A DataFrame whose row names are the preimage of the relabeling, column names</span>
</span><span id="populationoverlap-105"><a href="#populationoverlap-105"><span class="linenos">105</span></a><span class="sd">        are the image of the relabeling, and values edge weights; a cost matrix.</span>
</span><span id="populationoverlap-106"><a href="#populationoverlap-106"><span class="linenos">106</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="populationoverlap-107"><a href="#populationoverlap-107"><span class="linenos">107</span></a>    <span class="c1"># Make sure types are appropriate.</span>
</span><span id="populationoverlap-108"><a href="#populationoverlap-108"><span class="linenos">108</span></a>    <span class="n">right</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="populationoverlap-109"><a href="#populationoverlap-109"><span class="linenos">109</span></a>    <span class="n">right</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="populationoverlap-110"><a href="#populationoverlap-110"><span class="linenos">110</span></a>
</span><span id="populationoverlap-111"><a href="#populationoverlap-111"><span class="linenos">111</span></a>    <span class="n">left</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="populationoverlap-112"><a href="#populationoverlap-112"><span class="linenos">112</span></a>    <span class="n">left</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</span><span id="populationoverlap-113"><a href="#populationoverlap-113"><span class="linenos">113</span></a>
</span><span id="populationoverlap-114"><a href="#populationoverlap-114"><span class="linenos">114</span></a>    <span class="c1"># The preimage is the set of proposed-plan labels.</span>
</span><span id="populationoverlap-115"><a href="#populationoverlap-115"><span class="linenos">115</span></a>    <span class="n">preimage</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="populationoverlap-116"><a href="#populationoverlap-116"><span class="linenos">116</span></a>
</span><span id="populationoverlap-117"><a href="#populationoverlap-117"><span class="linenos">117</span></a>    <span class="c1"># Create a list of records from which we&#39;ll make a dataframe!</span>
</span><span id="populationoverlap-118"><a href="#populationoverlap-118"><span class="linenos">118</span></a>    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="populationoverlap-119"><a href="#populationoverlap-119"><span class="linenos">119</span></a>
</span><span id="populationoverlap-120"><a href="#populationoverlap-120"><span class="linenos">120</span></a>    <span class="c1"># For each label in the preimage, find the district which shares the most</span>
</span><span id="populationoverlap-121"><a href="#populationoverlap-121"><span class="linenos">121</span></a>    <span class="c1"># population; this is the cost matrix.</span>
</span><span id="populationoverlap-122"><a href="#populationoverlap-122"><span class="linenos">122</span></a>    <span class="k">for</span> <span class="n">fromlabel</span> <span class="ow">in</span> <span class="n">preimage</span><span class="p">:</span>
</span><span id="populationoverlap-123"><a href="#populationoverlap-123"><span class="linenos">123</span></a>        <span class="c1"># Find the blocks in the &quot;from&quot; district and see how much population each</span>
</span><span id="populationoverlap-124"><a href="#populationoverlap-124"><span class="linenos">124</span></a>        <span class="c1"># district shares with each enacted district.</span>
</span><span id="populationoverlap-125"><a href="#populationoverlap-125"><span class="linenos">125</span></a>        <span class="n">subleft</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">assignment</span><span class="p">]</span> <span class="o">==</span> <span class="n">fromlabel</span><span class="p">]</span>
</span><span id="populationoverlap-126"><a href="#populationoverlap-126"><span class="linenos">126</span></a>        <span class="n">subright</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subleft</span><span class="p">[</span><span class="n">identifier</span><span class="p">])]</span>
</span><span id="populationoverlap-127"><a href="#populationoverlap-127"><span class="linenos">127</span></a>
</span><span id="populationoverlap-128"><a href="#populationoverlap-128"><span class="linenos">128</span></a>        <span class="c1"># Aggregate shared blocks based on district label.</span>
</span><span id="populationoverlap-129"><a href="#populationoverlap-129"><span class="linenos">129</span></a>        <span class="n">agg</span> <span class="o">=</span> <span class="n">subright</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">assignment</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="populationoverlap-130"><a href="#populationoverlap-130"><span class="linenos">130</span></a>
</span><span id="populationoverlap-131"><a href="#populationoverlap-131"><span class="linenos">131</span></a>        <span class="c1"># Now figure out the shared populations.</span>
</span><span id="populationoverlap-132"><a href="#populationoverlap-132"><span class="linenos">132</span></a>        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="populationoverlap-133"><a href="#populationoverlap-133"><span class="linenos">133</span></a>            <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">shared</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shared</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">agg</span><span class="p">[</span><span class="n">assignment</span><span class="p">],</span> <span class="n">agg</span><span class="p">[</span><span class="n">population</span><span class="p">])}</span>
</span><span id="populationoverlap-134"><a href="#populationoverlap-134"><span class="linenos">134</span></a>        <span class="p">)</span>
</span><span id="populationoverlap-135"><a href="#populationoverlap-135"><span class="linenos">135</span></a>
</span><span id="populationoverlap-136"><a href="#populationoverlap-136"><span class="linenos">136</span></a>    <span class="c1"># Create the cost matrix!</span>
</span><span id="populationoverlap-137"><a href="#populationoverlap-137"><span class="linenos">137</span></a>    <span class="n">C</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="populationoverlap-138"><a href="#populationoverlap-138"><span class="linenos">138</span></a>    <span class="n">C</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">preimage</span>
</span><span id="populationoverlap-139"><a href="#populationoverlap-139"><span class="linenos">139</span></a>
</span><span id="populationoverlap-140"><a href="#populationoverlap-140"><span class="linenos">140</span></a>    <span class="k">return</span> <span class="n">C</span>
</span></pre></div>


            <div class="docstring"><p>Given two unit-level DataFrames — i.e. two dataframes where each row represents
an atomic unit like Census blocks or VTDs, and each row contains a district
assignment — computes the amount of population shared by each pair of districts.
<code>left</code> is the districting plan to be relabeled (e.g. a proposed districting
plan) and <code>right</code> is the districting plan with district labels we're trying
to match (e.g. an enacted districting plan). If <code>left</code> (denoted (L)) has
(n) districts and <code>right</code> (denoted (R)) has (m) districts, an
(n \times m) matrix (C) is computed, where the entry (M_{ij}) represents
the population shared by the districts (L_i) and (R_j). (C) is
represented as a pandas DataFrame, where the row indices are the labels in
<code>left</code>, and are the preimage of the label mapping; column indices are the labels
in <code>right</code>, and are the image of the label mapping.</p>

<p>Args:
    left (pd.DataFrame): DataFrame whose labels are the preimage of the relabeling.
    right (pd.DataFrame): DataFrame whose labels are the image of the relabeling.
    identifier (str): Column on <code>left</code> and <code>right</code> which contains the unique
        identifier for each unit.
    population (str): Column on <code>left</code> and <code>right</code> which contains the population
        total for each unit. This can be modified to be <code>any</code> population.
    assignment (str): Column on <code>left</code> and <code>right</code> that denotes district membership.</p>

<p>Returns:
    A DataFrame whose row names are the preimage of the relabeling, column names
    are the image of the relabeling, and values edge weights; a cost matrix.</p>
</div>


                </section>
                <section id="optimalrelabeling">
                            <input id="optimalrelabeling-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">optimalrelabeling</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">left</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">right</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">maximize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">costmatrix</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">populationoverlap</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="optimalrelabeling-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#optimalrelabeling"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="optimalrelabeling-143"><a href="#optimalrelabeling-143"><span class="linenos">143</span></a><span class="k">def</span> <span class="nf">optimalrelabeling</span><span class="p">(</span>
</span><span id="optimalrelabeling-144"><a href="#optimalrelabeling-144"><span class="linenos">144</span></a>    <span class="n">left</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="optimalrelabeling-145"><a href="#optimalrelabeling-145"><span class="linenos">145</span></a>    <span class="n">right</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="optimalrelabeling-146"><a href="#optimalrelabeling-146"><span class="linenos">146</span></a>    <span class="n">maximize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="optimalrelabeling-147"><a href="#optimalrelabeling-147"><span class="linenos">147</span></a>    <span class="n">costmatrix</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">populationoverlap</span><span class="p">,</span>
</span><span id="optimalrelabeling-148"><a href="#optimalrelabeling-148"><span class="linenos">148</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="optimalrelabeling-149"><a href="#optimalrelabeling-149"><span class="linenos">149</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="optimalrelabeling-150"><a href="#optimalrelabeling-150"><span class="linenos">150</span></a><span class="sd">    Finds the optimal relabeling for two districting plans.</span>
</span><span id="optimalrelabeling-151"><a href="#optimalrelabeling-151"><span class="linenos">151</span></a>
</span><span id="optimalrelabeling-152"><a href="#optimalrelabeling-152"><span class="linenos">152</span></a><span class="sd">    Args:</span>
</span><span id="optimalrelabeling-153"><a href="#optimalrelabeling-153"><span class="linenos">153</span></a><span class="sd">        left (Any): Data structure which can be passed to `costmatrix` to construct</span>
</span><span id="optimalrelabeling-154"><a href="#optimalrelabeling-154"><span class="linenos">154</span></a><span class="sd">            a cost matrix. District labels will be the preimage of the relabeling.</span>
</span><span id="optimalrelabeling-155"><a href="#optimalrelabeling-155"><span class="linenos">155</span></a><span class="sd">            If the default `costmatrix` function is used, these must be pandas</span>
</span><span id="optimalrelabeling-156"><a href="#optimalrelabeling-156"><span class="linenos">156</span></a><span class="sd">            DataFrames where one row corresponds to one atomic unit (e.g. Census</span>
</span><span id="optimalrelabeling-157"><a href="#optimalrelabeling-157"><span class="linenos">157</span></a><span class="sd">            blocks), with at least three columns: one denoting a unique geometric</span>
</span><span id="optimalrelabeling-158"><a href="#optimalrelabeling-158"><span class="linenos">158</span></a><span class="sd">            identifier (e.g. `GEOID20`), one denoting the districting assignment,</span>
</span><span id="optimalrelabeling-159"><a href="#optimalrelabeling-159"><span class="linenos">159</span></a><span class="sd">            and another denoting the population of choice. If</span>
</span><span id="optimalrelabeling-160"><a href="#optimalrelabeling-160"><span class="linenos">160</span></a><span class="sd">            `gerrytools.geometry.optimize.arealoverlap()` is used, these must be</span>
</span><span id="optimalrelabeling-161"><a href="#optimalrelabeling-161"><span class="linenos">161</span></a><span class="sd">            GeoDataFrames where one row corresponds to one district, and one</span>
</span><span id="optimalrelabeling-162"><a href="#optimalrelabeling-162"><span class="linenos">162</span></a><span class="sd">            column denotes the districts&#39; unique identifiers.</span>
</span><span id="optimalrelabeling-163"><a href="#optimalrelabeling-163"><span class="linenos">163</span></a><span class="sd">        right (Any): Data structure which can be passed to `costmatrix` to construct</span>
</span><span id="optimalrelabeling-164"><a href="#optimalrelabeling-164"><span class="linenos">164</span></a><span class="sd">            a cost matrix. District labels will be the image of the relabeling.</span>
</span><span id="optimalrelabeling-165"><a href="#optimalrelabeling-165"><span class="linenos">165</span></a><span class="sd">            If the default `costmatrix` function is used, these must be pandas</span>
</span><span id="optimalrelabeling-166"><a href="#optimalrelabeling-166"><span class="linenos">166</span></a><span class="sd">            DataFrames where one row corresponds to one atomic unit (e.g. Census</span>
</span><span id="optimalrelabeling-167"><a href="#optimalrelabeling-167"><span class="linenos">167</span></a><span class="sd">            blocks), with at least three columns: one denoting a unique geometric</span>
</span><span id="optimalrelabeling-168"><a href="#optimalrelabeling-168"><span class="linenos">168</span></a><span class="sd">            identifier (e.g. `GEOID20`), one denoting the districting assignment,</span>
</span><span id="optimalrelabeling-169"><a href="#optimalrelabeling-169"><span class="linenos">169</span></a><span class="sd">            and another denoting the population of choice. If</span>
</span><span id="optimalrelabeling-170"><a href="#optimalrelabeling-170"><span class="linenos">170</span></a><span class="sd">            `gerrytools.geometry.optimize.arealoverlap()` is used, these must be</span>
</span><span id="optimalrelabeling-171"><a href="#optimalrelabeling-171"><span class="linenos">171</span></a><span class="sd">            GeoDataFrames where one row corresponds to one district, and one</span>
</span><span id="optimalrelabeling-172"><a href="#optimalrelabeling-172"><span class="linenos">172</span></a><span class="sd">            column denotes the districts&#39; unique identifiers.</span>
</span><span id="optimalrelabeling-173"><a href="#optimalrelabeling-173"><span class="linenos">173</span></a><span class="sd">        maximize (bool): Are we finding the largest or smallest linear sum over</span>
</span><span id="optimalrelabeling-174"><a href="#optimalrelabeling-174"><span class="linenos">174</span></a><span class="sd">            the cost matrix? Defaults to `maximize=True`.</span>
</span><span id="optimalrelabeling-175"><a href="#optimalrelabeling-175"><span class="linenos">175</span></a><span class="sd">        costmatrix (Callable): The function (or partial function) which consumes</span>
</span><span id="optimalrelabeling-176"><a href="#optimalrelabeling-176"><span class="linenos">176</span></a><span class="sd">            `left` and `right` and spits out a cost matrix. This cost matrix is</span>
</span><span id="optimalrelabeling-177"><a href="#optimalrelabeling-177"><span class="linenos">177</span></a><span class="sd">            assumed to be a pandas DataFrame, with row indices old district labels</span>
</span><span id="optimalrelabeling-178"><a href="#optimalrelabeling-178"><span class="linenos">178</span></a><span class="sd">            and column names new district labels. Examples of these are</span>
</span><span id="optimalrelabeling-179"><a href="#optimalrelabeling-179"><span class="linenos">179</span></a><span class="sd">            `gerrytools.geometry.optimize.populationoverlap()` and</span>
</span><span id="optimalrelabeling-180"><a href="#optimalrelabeling-180"><span class="linenos">180</span></a><span class="sd">            `gerrytools.geometry.optimize.arealoverlap()`.</span>
</span><span id="optimalrelabeling-181"><a href="#optimalrelabeling-181"><span class="linenos">181</span></a>
</span><span id="optimalrelabeling-182"><a href="#optimalrelabeling-182"><span class="linenos">182</span></a><span class="sd">    Returns:</span>
</span><span id="optimalrelabeling-183"><a href="#optimalrelabeling-183"><span class="linenos">183</span></a><span class="sd">        A dictionary which maps district labels in `left` to district labels in</span>
</span><span id="optimalrelabeling-184"><a href="#optimalrelabeling-184"><span class="linenos">184</span></a><span class="sd">        `right`, according to the weighting scheme applied in `costmatrix`.</span>
</span><span id="optimalrelabeling-185"><a href="#optimalrelabeling-185"><span class="linenos">185</span></a>
</span><span id="optimalrelabeling-186"><a href="#optimalrelabeling-186"><span class="linenos">186</span></a><span class="sd">    &lt;/br&gt;</span>
</span><span id="optimalrelabeling-187"><a href="#optimalrelabeling-187"><span class="linenos">187</span></a>
</span><span id="optimalrelabeling-188"><a href="#optimalrelabeling-188"><span class="linenos">188</span></a><span class="sd">    This is an [assignment problem](https://bit.ly/3wnyS4F)</span>
</span><span id="optimalrelabeling-189"><a href="#optimalrelabeling-189"><span class="linenos">189</span></a><span class="sd">    and is equivalently a [(min/max)imal bipartite matching problem](http://bit.ly/2OfwUeh).</span>
</span><span id="optimalrelabeling-190"><a href="#optimalrelabeling-190"><span class="linenos">190</span></a><span class="sd">    Consider two districting plans \(L\) and \(R\), with \(n\) and \(m\) districts</span>
</span><span id="optimalrelabeling-191"><a href="#optimalrelabeling-191"><span class="linenos">191</span></a><span class="sd">    respectively. Set \(V_L\) and \(V_R\) to be sets of vertices such that</span>
</span><span id="optimalrelabeling-192"><a href="#optimalrelabeling-192"><span class="linenos">192</span></a><span class="sd">    a vertex \(l_i\) in \(V_L\) corresponds to the district \(L_i\) in \(L\), and</span>
</span><span id="optimalrelabeling-193"><a href="#optimalrelabeling-193"><span class="linenos">193</span></a><span class="sd">    similarly for vertices \(r_j\) in \(V_R\); draw edges \((l_i, r_j)\) for each</span>
</span><span id="optimalrelabeling-194"><a href="#optimalrelabeling-194"><span class="linenos">194</span></a><span class="sd">    \(i\) from \(1\) to \(n,\) and each \(j\) from \(1\) to \(m.\) In doing so,</span>
</span><span id="optimalrelabeling-195"><a href="#optimalrelabeling-195"><span class="linenos">195</span></a><span class="sd">    we construct the [bipartite graph](https://bit.ly/39rDldy) \(K_{n,m}\):</span>
</span><span id="optimalrelabeling-196"><a href="#optimalrelabeling-196"><span class="linenos">196</span></a>
</span><span id="optimalrelabeling-197"><a href="#optimalrelabeling-197"><span class="linenos">197</span></a><span class="sd">    &lt;div style=&quot;text-align: center;&quot;&gt;</span>
</span><span id="optimalrelabeling-198"><a href="#optimalrelabeling-198"><span class="linenos">198</span></a><span class="sd">        &lt;/br&gt;</span>
</span><span id="optimalrelabeling-199"><a href="#optimalrelabeling-199"><span class="linenos">199</span></a><span class="sd">        &lt;img width=&quot;40%&quot; src=&quot;../images/bipartite-matching.png&quot;/&gt;</span>
</span><span id="optimalrelabeling-200"><a href="#optimalrelabeling-200"><span class="linenos">200</span></a><span class="sd">    &lt;/div&gt;</span>
</span><span id="optimalrelabeling-201"><a href="#optimalrelabeling-201"><span class="linenos">201</span></a>
</span><span id="optimalrelabeling-202"><a href="#optimalrelabeling-202"><span class="linenos">202</span></a><span class="sd">    We then assign each edge a weight according to some function</span>
</span><span id="optimalrelabeling-203"><a href="#optimalrelabeling-203"><span class="linenos">203</span></a><span class="sd">    \(f: L\times R\ \to \mathbb{R}\), which consumes a pair of districts and returns</span>
</span><span id="optimalrelabeling-204"><a href="#optimalrelabeling-204"><span class="linenos">204</span></a><span class="sd">    a number. For example, this function could be the amount of area shared by</span>
</span><span id="optimalrelabeling-205"><a href="#optimalrelabeling-205"><span class="linenos">205</span></a><span class="sd">    the districts \(L_i\) and \(R_j\), like in `gerrytools.geometry.optimize.arealoverlap()`,</span>
</span><span id="optimalrelabeling-206"><a href="#optimalrelabeling-206"><span class="linenos">206</span></a><span class="sd">    or the amount of population the districts share, like in</span>
</span><span id="optimalrelabeling-207"><a href="#optimalrelabeling-207"><span class="linenos">207</span></a><span class="sd">    `gerrytools.geometry.optimize.populationoverlap()`.</span>
</span><span id="optimalrelabeling-208"><a href="#optimalrelabeling-208"><span class="linenos">208</span></a>
</span><span id="optimalrelabeling-209"><a href="#optimalrelabeling-209"><span class="linenos">209</span></a><span class="sd">    We then seek to find the set of weighted edges \(M\) such that all vertices</span>
</span><span id="optimalrelabeling-210"><a href="#optimalrelabeling-210"><span class="linenos">210</span></a><span class="sd">    \(l_i\) and \(r_j\) appear at most once in \(M\), and that the sum of \(M\)&#39;s</span>
</span><span id="optimalrelabeling-211"><a href="#optimalrelabeling-211"><span class="linenos">211</span></a><span class="sd">    weights is as small (or as large) as possible. To do so, we take the adjacency</span>
</span><span id="optimalrelabeling-212"><a href="#optimalrelabeling-212"><span class="linenos">212</span></a><span class="sd">    matrix \(A\) of our graph \(K_{n,m}\), where the \(i, j\)th entry records</span>
</span><span id="optimalrelabeling-213"><a href="#optimalrelabeling-213"><span class="linenos">213</span></a><span class="sd">    the weight of the edge \((l_i, r_j\)). Then, we want to select at most one entry</span>
</span><span id="optimalrelabeling-214"><a href="#optimalrelabeling-214"><span class="linenos">214</span></a><span class="sd">    in each row and column, and ensure those entries have the smallest (or greatest)</span>
</span><span id="optimalrelabeling-215"><a href="#optimalrelabeling-215"><span class="linenos">215</span></a><span class="sd">    possible sum. Using the [Jonker-Volgenant algorithm](DOI:10.1109/TAES.2016.140952) (as</span>
</span><span id="optimalrelabeling-216"><a href="#optimalrelabeling-216"><span class="linenos">216</span></a><span class="sd">    implemented by scipy), we can find the row and column indices of these entries,</span>
</span><span id="optimalrelabeling-217"><a href="#optimalrelabeling-217"><span class="linenos">217</span></a><span class="sd">    and retrieve the district label pairs corresponding to each. The algorithm</span>
</span><span id="optimalrelabeling-218"><a href="#optimalrelabeling-218"><span class="linenos">218</span></a><span class="sd">    achieves \(\textbf{O}(N^3)\) worst-case running time, where \(N = \max(n, m)\).</span>
</span><span id="optimalrelabeling-219"><a href="#optimalrelabeling-219"><span class="linenos">219</span></a>
</span><span id="optimalrelabeling-220"><a href="#optimalrelabeling-220"><span class="linenos">220</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="optimalrelabeling-221"><a href="#optimalrelabeling-221"><span class="linenos">221</span></a>    <span class="c1"># Our cost function should compute the weights between left and right. First,</span>
</span><span id="optimalrelabeling-222"><a href="#optimalrelabeling-222"><span class="linenos">222</span></a>    <span class="c1"># we want to identify the indices of the preimage (row index) and column</span>
</span><span id="optimalrelabeling-223"><a href="#optimalrelabeling-223"><span class="linenos">223</span></a>    <span class="n">C</span> <span class="o">=</span> <span class="n">costmatrix</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</span><span id="optimalrelabeling-224"><a href="#optimalrelabeling-224"><span class="linenos">224</span></a>    <span class="n">preimage</span><span class="p">,</span> <span class="n">image</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</span><span id="optimalrelabeling-225"><a href="#optimalrelabeling-225"><span class="linenos">225</span></a>
</span><span id="optimalrelabeling-226"><a href="#optimalrelabeling-226"><span class="linenos">226</span></a>    <span class="c1"># Now we do our linear sum assignment, getting back the indices which maximize</span>
</span><span id="optimalrelabeling-227"><a href="#optimalrelabeling-227"><span class="linenos">227</span></a>    <span class="c1"># the total weight on the edges!</span>
</span><span id="optimalrelabeling-228"><a href="#optimalrelabeling-228"><span class="linenos">228</span></a>    <span class="n">preimageindices</span><span class="p">,</span> <span class="n">imageindices</span> <span class="o">=</span> <span class="n">lsa</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">maximize</span><span class="o">=</span><span class="n">maximize</span><span class="p">)</span>
</span><span id="optimalrelabeling-229"><a href="#optimalrelabeling-229"><span class="linenos">229</span></a>    <span class="n">preimage</span> <span class="o">=</span> <span class="p">[</span><span class="n">preimage</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">preimageindices</span><span class="p">]</span>
</span><span id="optimalrelabeling-230"><a href="#optimalrelabeling-230"><span class="linenos">230</span></a>    <span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">imageindices</span><span class="p">]</span>
</span><span id="optimalrelabeling-231"><a href="#optimalrelabeling-231"><span class="linenos">231</span></a>
</span><span id="optimalrelabeling-232"><a href="#optimalrelabeling-232"><span class="linenos">232</span></a>    <span class="c1"># Zip the preimage and image into a dict, and we&#39;re done!</span>
</span><span id="optimalrelabeling-233"><a href="#optimalrelabeling-233"><span class="linenos">233</span></a>    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">preimage</span><span class="p">,</span> <span class="n">image</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Finds the optimal relabeling for two districting plans.</p>

<p>Args:
    left (Any): Data structure which can be passed to <code>costmatrix</code> to construct
        a cost matrix. District labels will be the preimage of the relabeling.
        If the default <code>costmatrix</code> function is used, these must be pandas
        DataFrames where one row corresponds to one atomic unit (e.g. Census
        blocks), with at least three columns: one denoting a unique geometric
        identifier (e.g. <code>GEOID20</code>), one denoting the districting assignment,
        and another denoting the population of choice. If
        <code><a href="#arealoverlap">gerrytools.geometry.arealoverlap()</a></code> is used, these must be
        GeoDataFrames where one row corresponds to one district, and one
        column denotes the districts' unique identifiers.
    right (Any): Data structure which can be passed to <code>costmatrix</code> to construct
        a cost matrix. District labels will be the image of the relabeling.
        If the default <code>costmatrix</code> function is used, these must be pandas
        DataFrames where one row corresponds to one atomic unit (e.g. Census
        blocks), with at least three columns: one denoting a unique geometric
        identifier (e.g. <code>GEOID20</code>), one denoting the districting assignment,
        and another denoting the population of choice. If
        <code><a href="#arealoverlap">gerrytools.geometry.arealoverlap()</a></code> is used, these must be
        GeoDataFrames where one row corresponds to one district, and one
        column denotes the districts' unique identifiers.
    maximize (bool): Are we finding the largest or smallest linear sum over
        the cost matrix? Defaults to <code>maximize=True</code>.
    costmatrix (Callable): The function (or partial function) which consumes
        <code>left</code> and <code>right</code> and spits out a cost matrix. This cost matrix is
        assumed to be a pandas DataFrame, with row indices old district labels
        and column names new district labels. Examples of these are
        <code><a href="#populationoverlap">gerrytools.geometry.populationoverlap()</a></code> and
        <code><a href="#arealoverlap">gerrytools.geometry.arealoverlap()</a></code>.</p>

<p>Returns:
    A dictionary which maps district labels in <code>left</code> to district labels in
    <code>right</code>, according to the weighting scheme applied in <code>costmatrix</code>.</p>

<p></br></p>

<p>This is an <a href="https://bit.ly/3wnyS4F">assignment problem</a>
and is equivalently a <a href="http://bit.ly/2OfwUeh">(min/max)imal bipartite matching problem</a>.
Consider two districting plans (L) and (R), with (n) and (m) districts
respectively. Set (V_L) and (V_R) to be sets of vertices such that
a vertex (l_i) in (V_L) corresponds to the district (L_i) in (L), and
similarly for vertices (r_j) in (V_R); draw edges ((l_i, r_j)) for each
(i) from (1) to (n,) and each (j) from (1) to (m.) In doing so,
we construct the <a href="https://bit.ly/39rDldy">bipartite graph</a> (K_{n,m}):</p>

<div style="text-align: center;">
    </br>
    <img width="40%" src="../images/bipartite-matching.png"/>
</div>

<p>We then assign each edge a weight according to some function
(f: L\times R\ \to \mathbb{R}), which consumes a pair of districts and returns
a number. For example, this function could be the amount of area shared by
the districts (L_i) and (R_j), like in <code><a href="#arealoverlap">gerrytools.geometry.arealoverlap()</a></code>,
or the amount of population the districts share, like in
<code><a href="#populationoverlap">gerrytools.geometry.populationoverlap()</a></code>.</p>

<p>We then seek to find the set of weighted edges (M) such that all vertices
(l_i) and (r_j) appear at most once in (M), and that the sum of (M)'s
weights is as small (or as large) as possible. To do so, we take the adjacency
matrix (A) of our graph (K_{n,m}), where the (i, j)th entry records
the weight of the edge ((l_i, r_j)). Then, we want to select at most one entry
in each row and column, and ensure those entries have the smallest (or greatest)
possible sum. Using the <a href="DOI:10.1109/TAES.2016.140952">Jonker-Volgenant algorithm</a> (as
implemented by scipy), we can find the row and column indices of these entries,
and retrieve the district label pairs corresponding to each. The algorithm
achieves (\textbf{O}(N^3)) worst-case running time, where (N = \max(n, m)).</p>
</div>


                </section>
                <section id="arealoverlap">
                            <input id="arealoverlap-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arealoverlap</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">left</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">right</span><span class="p">:</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>,</span><span class="param">	<span class="n">assignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;DISTRICT&#39;</span>,</span><span class="param">	<span class="n">crs</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>:</span></span>

                <label class="view-source-button" for="arealoverlap-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#arealoverlap"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="arealoverlap-13"><a href="#arealoverlap-13"><span class="linenos">13</span></a><span class="k">def</span> <span class="nf">arealoverlap</span><span class="p">(</span>
</span><span id="arealoverlap-14"><a href="#arealoverlap-14"><span class="linenos">14</span></a>    <span class="n">left</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="arealoverlap-15"><a href="#arealoverlap-15"><span class="linenos">15</span></a>    <span class="n">right</span><span class="p">:</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">,</span>
</span><span id="arealoverlap-16"><a href="#arealoverlap-16"><span class="linenos">16</span></a>    <span class="n">assignment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;DISTRICT&quot;</span><span class="p">,</span>
</span><span id="arealoverlap-17"><a href="#arealoverlap-17"><span class="linenos">17</span></a>    <span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="arealoverlap-18"><a href="#arealoverlap-18"><span class="linenos">18</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="arealoverlap-19"><a href="#arealoverlap-19"><span class="linenos">19</span></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="arealoverlap-20"><a href="#arealoverlap-20"><span class="linenos">20</span></a><span class="sd">    Given two GeoDataFrames, each encoding districting plans, computes the areal</span>
</span><span id="arealoverlap-21"><a href="#arealoverlap-21"><span class="linenos">21</span></a><span class="sd">    overlap between each pair of districts. `left` is the districting plan to be</span>
</span><span id="arealoverlap-22"><a href="#arealoverlap-22"><span class="linenos">22</span></a><span class="sd">    relabeled (e.g. a proposed districting plan) and `right` is the districting</span>
</span><span id="arealoverlap-23"><a href="#arealoverlap-23"><span class="linenos">23</span></a><span class="sd">    plan with district labels we&#39;re trying to match (e.g. an enacted districting</span>
</span><span id="arealoverlap-24"><a href="#arealoverlap-24"><span class="linenos">24</span></a><span class="sd">    plan). If `left` (denoted \(L\)) has \(n\) districts and `right` (denoted \(R\)) has</span>
</span><span id="arealoverlap-25"><a href="#arealoverlap-25"><span class="linenos">25</span></a><span class="sd">    \(m\) districts, an \(n \times m\) matrix \(C\) is computed, where the entry</span>
</span><span id="arealoverlap-26"><a href="#arealoverlap-26"><span class="linenos">26</span></a><span class="sd">    \(M_{ij}\) represents the area of the intersection of the districts \(L_i\) and</span>
</span><span id="arealoverlap-27"><a href="#arealoverlap-27"><span class="linenos">27</span></a><span class="sd">    \(R_j\). \(C\) is represented as a pandas DataFrame, where the row indices are</span>
</span><span id="arealoverlap-28"><a href="#arealoverlap-28"><span class="linenos">28</span></a><span class="sd">    the labels in `left`, and are the preimage of the label mapping; column indices</span>
</span><span id="arealoverlap-29"><a href="#arealoverlap-29"><span class="linenos">29</span></a><span class="sd">    are the labels in `right`, and are the image of the label mapping.</span>
</span><span id="arealoverlap-30"><a href="#arealoverlap-30"><span class="linenos">30</span></a>
</span><span id="arealoverlap-31"><a href="#arealoverlap-31"><span class="linenos">31</span></a><span class="sd">    Args:</span>
</span><span id="arealoverlap-32"><a href="#arealoverlap-32"><span class="linenos">32</span></a><span class="sd">        left (pd.DataFrame): GeoDataFrame whose labels are the preimage of the</span>
</span><span id="arealoverlap-33"><a href="#arealoverlap-33"><span class="linenos">33</span></a><span class="sd">            relabeling.</span>
</span><span id="arealoverlap-34"><a href="#arealoverlap-34"><span class="linenos">34</span></a><span class="sd">        right (pd.DataFrame): GeoDataFrame whose labels are the image of the</span>
</span><span id="arealoverlap-35"><a href="#arealoverlap-35"><span class="linenos">35</span></a><span class="sd">            relabeling.</span>
</span><span id="arealoverlap-36"><a href="#arealoverlap-36"><span class="linenos">36</span></a><span class="sd">        assignment (str): Column on `left` and `right` which contains the district</span>
</span><span id="arealoverlap-37"><a href="#arealoverlap-37"><span class="linenos">37</span></a><span class="sd">            identifier.</span>
</span><span id="arealoverlap-38"><a href="#arealoverlap-38"><span class="linenos">38</span></a>
</span><span id="arealoverlap-39"><a href="#arealoverlap-39"><span class="linenos">39</span></a><span class="sd">    Returns:</span>
</span><span id="arealoverlap-40"><a href="#arealoverlap-40"><span class="linenos">40</span></a><span class="sd">        Cost matrix \(C\), represented as a DataFrame.</span>
</span><span id="arealoverlap-41"><a href="#arealoverlap-41"><span class="linenos">41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="arealoverlap-42"><a href="#arealoverlap-42"><span class="linenos">42</span></a>    <span class="c1"># Force the two things to be the same CRS (or the provided CRS)</span>
</span><span id="arealoverlap-43"><a href="#arealoverlap-43"><span class="linenos">43</span></a>    <span class="k">if</span> <span class="n">crs</span><span class="p">:</span>
</span><span id="arealoverlap-44"><a href="#arealoverlap-44"><span class="linenos">44</span></a>        <span class="n">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="arealoverlap-45"><a href="#arealoverlap-45"><span class="linenos">45</span></a>        <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
</span><span id="arealoverlap-46"><a href="#arealoverlap-46"><span class="linenos">46</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="arealoverlap-47"><a href="#arealoverlap-47"><span class="linenos">47</span></a>        <span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</span><span id="arealoverlap-48"><a href="#arealoverlap-48"><span class="linenos">48</span></a>
</span><span id="arealoverlap-49"><a href="#arealoverlap-49"><span class="linenos">49</span></a>    <span class="c1"># An empty list of records for everything.</span>
</span><span id="arealoverlap-50"><a href="#arealoverlap-50"><span class="linenos">50</span></a>    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="arealoverlap-51"><a href="#arealoverlap-51"><span class="linenos">51</span></a>
</span><span id="arealoverlap-52"><a href="#arealoverlap-52"><span class="linenos">52</span></a>    <span class="c1"># Figure out the image as we go along.</span>
</span><span id="arealoverlap-53"><a href="#arealoverlap-53"><span class="linenos">53</span></a>    <span class="n">image</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="arealoverlap-54"><a href="#arealoverlap-54"><span class="linenos">54</span></a>
</span><span id="arealoverlap-55"><a href="#arealoverlap-55"><span class="linenos">55</span></a>    <span class="c1"># Now, iterate over each dissolved district, finding the areal overlap with</span>
</span><span id="arealoverlap-56"><a href="#arealoverlap-56"><span class="linenos">56</span></a>    <span class="c1"># enacted districts.</span>
</span><span id="arealoverlap-57"><a href="#arealoverlap-57"><span class="linenos">57</span></a>    <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">pdistrict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="n">assignment</span><span class="p">],</span> <span class="n">left</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]):</span>
</span><span id="arealoverlap-58"><a href="#arealoverlap-58"><span class="linenos">58</span></a>        <span class="n">image</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
</span><span id="arealoverlap-59"><a href="#arealoverlap-59"><span class="linenos">59</span></a>        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="arealoverlap-60"><a href="#arealoverlap-60"><span class="linenos">60</span></a>            <span class="p">{</span>
</span><span id="arealoverlap-61"><a href="#arealoverlap-61"><span class="linenos">61</span></a>                <span class="n">eid</span><span class="p">:</span> <span class="n">pdistrict</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">edistrict</span><span class="p">)</span><span class="o">.</span><span class="n">area</span>
</span><span id="arealoverlap-62"><a href="#arealoverlap-62"><span class="linenos">62</span></a>                <span class="k">for</span> <span class="n">eid</span><span class="p">,</span> <span class="n">edistrict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="n">assignment</span><span class="p">],</span> <span class="n">right</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
</span><span id="arealoverlap-63"><a href="#arealoverlap-63"><span class="linenos">63</span></a>            <span class="p">}</span>
</span><span id="arealoverlap-64"><a href="#arealoverlap-64"><span class="linenos">64</span></a>        <span class="p">)</span>
</span><span id="arealoverlap-65"><a href="#arealoverlap-65"><span class="linenos">65</span></a>
</span><span id="arealoverlap-66"><a href="#arealoverlap-66"><span class="linenos">66</span></a>    <span class="c1"># Create a dataframe from that!</span>
</span><span id="arealoverlap-67"><a href="#arealoverlap-67"><span class="linenos">67</span></a>    <span class="n">weighted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</span><span id="arealoverlap-68"><a href="#arealoverlap-68"><span class="linenos">68</span></a>    <span class="n">weighted</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="arealoverlap-69"><a href="#arealoverlap-69"><span class="linenos">69</span></a>
</span><span id="arealoverlap-70"><a href="#arealoverlap-70"><span class="linenos">70</span></a>    <span class="k">return</span> <span class="n">weighted</span>
</span></pre></div>


            <div class="docstring"><p>Given two GeoDataFrames, each encoding districting plans, computes the areal
overlap between each pair of districts. <code>left</code> is the districting plan to be
relabeled (e.g. a proposed districting plan) and <code>right</code> is the districting
plan with district labels we're trying to match (e.g. an enacted districting
plan). If <code>left</code> (denoted (L)) has (n) districts and <code>right</code> (denoted (R)) has
(m) districts, an (n \times m) matrix (C) is computed, where the entry
(M_{ij}) represents the area of the intersection of the districts (L_i) and
(R_j). (C) is represented as a pandas DataFrame, where the row indices are
the labels in <code>left</code>, and are the preimage of the label mapping; column indices
are the labels in <code>right</code>, and are the image of the label mapping.</p>

<p>Args:
    left (pd.DataFrame): GeoDataFrame whose labels are the preimage of the
        relabeling.
    right (pd.DataFrame): GeoDataFrame whose labels are the image of the
        relabeling.
    assignment (str): Column on <code>left</code> and <code>right</code> which contains the district
        identifier.</p>

<p>Returns:
    Cost matrix (C), represented as a DataFrame.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>